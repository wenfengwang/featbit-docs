import { Callout } from 'nextra/components'

# 百分比发布

## 概览 <a href="#overview" id="overview"></a>

本主题解释了如何使用百分比发布逐步向用户推出新功能。

百分比发布允许您通过逐渐向用户发布功能来管理部署风险。您可以将功能推出给一小部分随机用户，随着对功能运行情况的信心增强，逐渐增加推出的用户比例。

## 创建百分比发布 <a href="#creating-percentage-rollouts" id="creating-percentage-rollouts"></a>

您可以在功能标志的目标规则或默认规则中创建百分比发布。

这是默认规则中百分比发布的示意图：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/001.png)

在这个例子中，25% 的用户将获得新功能。如果新功能按预期工作，您可以逐步增加获得新功能的用户比例，直到最终达到 100%。

如果您想向极少数用户推出一个变种，您可以为一个变种分配少于 1% 的比例。例如，您可以使用三位小数，如 0.125%。

## 理解百分比发布逻辑 <a href="#understanding-percentage-rollout-logic" id="understanding-percentage-rollout-logic"></a>

当您设置百分比发布时，每个用户会根据他们的 user_key 接收到特定的变种。

百分比发布逻辑基于 user_keyId 生成一个哈希值。SDK 使用这个哈希值为该用户生成一个百分比值。该值与设置的百分比发布值比较，决定用户接收哪个变种。哈希值分布在 0 到 2147483648 的范围内。当您为变种分配标志时，哈希值会按顺序为每个分区的用户分配从 0 到 2147483648 的值。例如，当您为变种 A 分配 50% 时，FeatBit 会将变种 A 提供给从 1 到 1073741824 的哈希分区。

百分比发布的一个常见用途是随着时间的推移逐步增加标志目标用户的百分比，直到 100% 的用户接收到标志的某个变种。当您更改用户对标志变种的百分比分配时，这些用户会根据他们分区在 0 到 2147483648 的哈希列表中的位置被重新分配不同的标志变种。例如，如果您将接收变种 A 的用户比例从 50% 调整到 70%，那么 1073741825 到 1503238554 的分区将被添加到已经接收变种 A 的分区集合中。

### 使用高级发布 <a href="#using-advanced-rollouts" id="using-advanced-rollouts"></a>

您可以根据 **Dispatch by** 菜单中的任何用户属性为用户分配变种。

例如，您可以向 25% 的用户推出一个功能，但不是随机分配变种，而是基于他们的 `team-region` 属性值来分配变种。这确保了 FeatBit 会将所有具有相同属性值对的用户分配到同一变种。

这是高级发布的示意图：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/002.webp)
