import { Callout } from 'nextra/components'

# 使用 FeatBit REST API

### 概述 <a href="#overview" id="overview"></a>

本指南旨在介绍如何使用 FeatBit REST API。它描述了如何创建 API 访问令牌、发出请求和评估响应。还介绍了常见的用例，并帮助您熟悉 FeatBit API 文档。

FeatBit REST API 是与 FeatBit 用户界面（UI）交互的编程替代方案。您可以使用 FeatBit API 执行标志列表中的任何操作，包括创建和操作标志。例如，REST API 经常用于切换功能标志、更新段和构建自定义集成。

> 使用 FeatBit SDK 评估标志
>
> 我们 _不建议_ 在应用程序代码中使用 REST API 评估功能标志。请使用 FeatBit SDK。SDK 包括诸如标志值缓存和更新流式传输等功能，这些功能在使用 REST API 评估标志值时不会自动接收。要了解更多，请阅读 [连接 SDK](../getting-started/connect-an-sdk/)。

在本指南中，您将：

* 设置请求标头以访问 FeatBit API，包括创建访问令牌
* 使用 REST API 阅读 FeatBit 资源的详细信息
* 使用 REST API 创建和更新 FeatBit 资源
* 了解使用 REST API 的常见用例

### 先决条件 <a href="#prerequisites" id="prerequisites"></a>

要完成本指南，您必须满足以下先决条件：

* 在本地或服务器上运行 FeatBit，请参阅 [安装](../installation/full-installation.md)。
* 可以使用工具调用 REST API。有许多选择，如下所述：
  * [Curl](https://curl.se/)
  * [Postman](https://www.postman.com/)
  * [FeatBit API 文档](overview.md)

#### Curl <a href="#curl" id="curl"></a>

[Curl](https://curl.se/) 是一种常见的命令行工具，可用于调用 REST API。本指南在示例中使用了 curl。您可以从自己的命令行运行本指南中的示例。

#### Postman <a href="#postman" id="postman"></a>

[Postman](https://www.postman.com/) 平台是调用 REST API 的另一种选择。它提供了用于设置、执行和存储 REST 请求的工具。您可以创建免费的 Postman 帐户，并从 Postman 客户端运行本指南中的示例。

#### FeatBit API 文档 <a href="#launchdarkly-api-documentation" id="launchdarkly-api-documentation"></a>

FeatBit API 文档提供了每个记录请求的示例。

#### FeatBit 数据层次结构 <a href="#launchdarkly-data-hierarchy" id="launchdarkly-data-hierarchy"></a>

FeatBit 帐户可以包含一个或多个 **项目**。项目中可以包含多个 **环境**，而 **功能标志** 存在于项目的环境中。创建新标志时，仅在该环境中创建该标志。所有标志配置设置都特定于每个环境。在一个环境中所做的更改不适用于任何其他环境。如果需要，可以为每个环境以独特的方式配置相同的标志。

许多软件项目在每个项目中都有一个测试、暂存和生产环境。在 FeatBit 中，您可以定义适合您组织需求的任何环境结构。例如，您的移动团队可能需要在“移动应用”项目中拥有 `android test`、`android prod`、`ios test` 和 `ios prod` 环境。

### 设置标头 <a href="#setting-up-your-headers" id="setting-up-your-headers"></a>

每个请求都需要一些必需的标头信息。标头由键/值对组成。许多用于发出请求的工具（包括 curl 和 Postman）都会在请求之间为您保存这些标头。

<Callout type="info">
如果您使用的是 Postman，请确保选中 **Host** 和 **Content-Length** 标头。如果您使用的是 **curl** 或其他工具，则会自动添加这两个标头。
</Callout>

#### 必需的标头 <a href="#required-headers" id="required-headers"></a>

对于所有请求，都需要 `Authorization` 标头。此标头用于身份验证，并检查您是否有权对指定资源执行请求的操作。例如，如果您请求有关某个项目的信息，但您没有读取该项目的权限，响应将是一个错误，指示您没有足够的权限。

`Authorization` 标头的值是 API 访问令牌。访问令牌可以是个人令牌，也可以是服务令牌。在 FeatBit 中，您可以从“集成/访问令牌”页面创建访问令牌。在本指南中，您需要一个具有功能标志 **ManageFeatureFlag** 权限的令牌，因此在创建令牌时，请选择 **ManageFeatureFlag** 权限（默认情况下已选择）。

要了解更多，请阅读 [创建 API 访问令牌](../integrations/api-access-tokens.md)。

不能将 SDK 密钥用作访问令牌

对于包含请求正文的所有请求，API 需要一个 `Content-Type` 值为 `application/json`。如果请求不包含正文，API 将忽略 `Content-Type` 标头。这意味着始终包含 `Content-Type` 标头是安全的，即使 API 不需要它。

要在 curl 中包含请求所需的标头，请使用 `-H` 选项：

示例 curl

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/9d782f01-6ffb-4a7c-83a2-79304d801a46/feature-flags' \  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \  -H 'Content-Type: application/json'COPY
```

在此示例中，`-X` 选项指定请求类型，`PATCH`。URL 指定请求处理的资源。每个 `-H` 选项指定将包含在请求中的标头。每次使用 curl 发出请求时，都必须包含 `-X`、请求类型、URL 和标头。

### 练习：阅读标志列表 <a href="#exercise-reading-flag-and-environment-information" id="exercise-reading-flag-and-environment-information"></a>

#### 获取环境 ID <a href="#reading-a-flag" id="reading-a-flag"></a>

如上所述，功能标志是特定于环境的。要列出环境的功能标志，我们需要环境 ID（在功能中，可以使用环境键调用 API）。

要获取环境 ID，请执行以下操作：

1. 转到 **组织** 页面，然后单击 **项目** 选项卡。
2. 在项目列表中，找到要连接的项目和环境。
3. 单击 **复制 ID** 按钮，环境 ID 将被复制到剪贴板

![](../api-docs/assets/using-featbit-rest-api/001.png)

#### 调用 API

使用上一步中的环境 ID，进行以下调用

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/[YOUR ENVIRONMENT ID]/feature-flags?pageIndex=0&pageSize=10&isEnabled=' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN'
  -H 'Content-Type: application/json'
```

对此请求的响应是一个 `200` 成功代码和一个 JSON 对象，其中包含该环境的所有功能标志。例如：

```json
{
    "success": true,
    "errors": [],
    "data": {
        "totalCount": 1,
        "items": [
            {
                "id": "e3d78102-8a67-4698-a744-afcb005e8dfa",
                "name": "flag 1",
                "description": "",
                "key": "flag-1",
                "isEnabled": false,
                "variationType": "boolean",
                "variations": [
                    {
                        "id": "838b01b2-d443-4317-b8d3-adb2bed483c0",
                        "value": "true"
                    },
                    {
                        "id": "0c742a83-0053-4f37-8f34-9ef164c17875",
                        "value": "false"
                    }
                ],
                "updatedAt": "2023-03-20T05:44:15.765Z",
                "serves": {
                    "enabledVariations": [
                        "true"
                    ],
                    "disabledVariation": "false"
                },
                "tags": []
            }
        ]
    }
}