import { Callout } from 'nextra/components'

# 使用 FeatBit REST API

### 概览 <a href="#overview" id="overview"></a>

本指南解释了如何开始使用 FeatBit REST API。它描述了如何创建 API 访问令牌、进行请求和评估响应。它介绍了常见用例，并帮助您熟悉 FeatBit API 文档。

FeatBit REST API 是与 FeatBit 用户界面（UI）交互的编程替代方法。您可以使用 FeatBit API 执行标志列表中可用的任何操作，包括创建和操纵标志。例如，REST API 经常用于切换功能标志、更新细分市场和构建自定义集成。

> 使用 FeatBit SDK 来评估标志
>
> 我们 _不_ 推荐在您的应用程序代码中使用 REST API 来评估功能标志。相反，您应该使用 FeatBit SDK。SDK 包括像标志值缓存和更新流等特性，这些是您在使用 REST API 评估标志值时不会自动获得的。要了解更多，请阅读 [连接 SDK](../getting-started/connect-an-sdk/)。

在本指南中，您将：

* 设置请求头以访问 FeatBit API，包括创建访问令牌
* 使用 REST API 读取 FeatBit 资源的详细信息
* 使用 REST API 创建和更新 FeatBit 资源
* 学习与 REST API 协作的常见用例

### 先决条件 <a href="#prerequisites" id="prerequisites"></a>

要完成本指南，您必须具备以下先决条件：

* 在本地或服务器上运行 FeatBit，阅读 [安装指南](../installation/full-installation.md)。
* 能够使用工具进行 REST API 调用。以下是一些可用的选项：
  * [Curl](https://curl.se/)
  * [Postman](https://www.postman.com/)
  * [FeatBit API 文档](overview.md)

#### Curl <a href="#curl" id="curl"></a>

[Curl](https://curl.se/) 是一个常用的命令行工具，您可以用它来发起 REST API 调用。本指南的示例中会使用 curl。您可以在自己的命令行中运行本指南的示例。

#### Postman <a href="#postman" id="postman"></a>

[Postman](https://www.postman.com/) 平台是另一个用于发起 REST API 调用的选择。它提供了一套工具用于设置、执行和存储 REST 请求。您可以创建一个免费的 Postman 账户，并在 Postman 客户端中运行本指南的示例。

#### FeatBit API 文档 <a href="#launchdarkly-api-documentation" id="launchdarkly-api-documentation"></a>

FeatBit API 文档提供了每个文档化请求的示例。

#### FeatBit 数据层次结构 <a href="#launchdarkly-data-hierarchy" id="launchdarkly-data-hierarchy"></a>

FeatBit 账户可以包含一个或多个 **项目**。一个项目可以包含多个 **环境**，**功能标志** 则存在于项目的某个环境中。当您创建一个新标志时，它只会在那个环境中创建。所有标志配置设置都是针对每个环境的。您在一个环境中所做的更改不会应用到其他环境。如果您愿意，您可以为每个环境以独特的方式配置同一个标志。

许多软件项目都会在每个项目中设置测试、预发布和生产环境。在 FeatBit 中，您可以定义适合您组织需求的任何环境结构。例如，您的移动团队可能需要在“移动应用”项目中设置 `android test`、`android prod`、`ios test` 和 `ios prod` 环境。

### 设置您的请求头 <a href="#setting-up-your-headers" id="setting-up-your-headers"></a>

您发出的每个请求都需要包含请求头信息。请求头由键值对组成。许多用于发起请求的工具，包括 curl 和 Postman，都会在请求之间为您保存这些请求头。

<Callout type="info">
如果您使用 Postman，请确保选中 **Host** 和 **Content-Length** 请求头。如果您使用 **curl** 或其他工具，这两个请求头会自动添加。
</Callout>

#### 必需的请求头 <a href="#required-headers" id="required-headers"></a>

对于所有请求，`Authorization` 请求头是必需的。这个请求头用于身份验证，并检查您是否有权限对指定资源执行请求的操作。例如，如果您请求有关项目的信息，但您没有该项目的读取权限，则响应将是一个错误，表明您没有足够的权限。

`Authorization` 请求头的值是一个 API 访问令牌。访问令牌可以是个人令牌或服务令牌。在 FeatBit 中，您可以从 **集成/访问令牌** 页面创建访问令牌。对于本指南，您需要一个具有功能标志 **ManageFeatureFlag** 权限的令牌，所以在创建令牌时选择 **ManageFeatureFlag** 权限（默认已选中）。

要了解更多，请阅读 [创建 API 访问令牌](../integrations/api-access-tokens.md)。

SDK 密钥不能用作访问令牌

对于所有包含请求体的请求，API 需要一个 `Content-Type` 请求头，其值为 `application/json`。如果请求不包含请求体，则 API 会忽略 `Content-Type` 请求头。这意味着即使 API 不要求，始终包含 `Content-Type` 请求头也是安全的。

要在 curl 中包含您的请求所需的请求头，请使用 `-H` 选项：

示例 curl

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/9d782f01-6ffb-4a7c-83a2-79304d801a46/feature-flags' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \
  -H 'Content-Type: application/json'
```

在此示例中，`-X` 选项指定了请求的类型，`GET`。URL 指定了请求所作用的资源。每个 `-H` 选项指定了将包含在请求中的一个请求头。您每次使用 curl 发起请求时，都必须包括 `-X`、请求类型、URL 和请求头。

### 练习：阅读标志列表 <a href="#exercise-reading-flag-and-environment-information" id="exercise-reading-flag-and-environment-information"></a>

#### 获取环境 ID <a href="#reading-a-flag" id="reading-a-flag"></a>

如上所述，功能标志是特定于环境的。要列出一个环境的功能标志，我们需要该环境的 ID（将来可能可以使用环境键来调用 API）。

获取环境 ID 的步骤如下：

1. 转到 **组织** 页面，点击 **项目** 标签页。
2. 在项目列表中，找到您想要连接的项目和环境。
3. 点击 **复制 ID** 按钮，环境 ID 将被复制到剪贴板。

![](../api-docs/assets/using-featbit-rest-api/001.png)

#### 调用 API

使用上一步骤中获得的环境 ID，发起以下调用：

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/[YOUR ENVIRONMENT ID]/feature-flags?pageIndex=0&pageSize=10&isEnabled=' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \
  -H 'Content-Type: application/json'
```

对此请求的响应是一个 `200` 成功代码和一个包含该环境功能标志的所有信息的 JSON 对象。例如：

```json
{
    "success": true,
    "errors": [],
    "data": {
        "totalCount": 1,
        "items": [
            {
                "id": "e3d78102-8a67-4698-a744-afcb005e8dfa",
                "name": "flag 1",
                "description": "",
                "key": "flag-1",
                "isEnabled": false,
                "variationType": "boolean",
                "variations": [
                    {
                        "id": "838b01b2-d443-4317-b8d3-adb2bed483c0",
                        "value": "true"
                    },
                    {
                        "id": "0c742a83-0053-4f37-8f34-9ef164c17875",
                        "value": "false"
                    }
                ],
                "updatedAt": "2023-03-20T05:44:15.765Z",
                "serves": {
                    "enabledVariations": [
                        "true"
                    ],
                    "disabledVariation": "false"
                },
                "tags": []
            }
        ]
    }
}
```

