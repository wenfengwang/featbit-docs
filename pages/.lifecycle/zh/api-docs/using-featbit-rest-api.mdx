
从 'nextra/components' 导入 { Callout }

# 使用 FeatBit REST API

### 概览

本指南将介绍如何开始使用 FeatBit REST API。它详细说明了如何创建 API 访问令牌、发起请求以及解读响应。本指南还将介绍一些常见用例，帮助您熟悉 FeatBit API 文档。

FeatBit REST API 提供了一种编程方式来代替与 FeatBit 用户界面（UI）的交互。您可以利用 FeatBit API 来执行标志列表中的任何操作，包括创建和管理标志。例如，REST API 常用于切换功能标志、更新细分市场以及构建自定义集成。

> 使用 FeatBit SDKs 来评估标志
> 我们不建议在应用程序代码中使用 REST API 来评估功能标志。相反，应使用 FeatBit SDK。SDK 提供了多种特性，如标志值的缓存和更新的流式传输，这些在使用 REST API 评估标志值时不会自动获得。要了解更多信息，请阅读[连接 SDK](../getting-started/connect-an-sdk/)部分。

在本指南中，您将学会：

* 设置请求头以访问 FeatBit API，包括创建访问令牌
* 利用 REST API 读取 FeatBit 资源的详细信息
* 使用 REST API 创建和更新 FeatBit 资源
* 学习与 REST API 协作的常见用例

### 先决条件

要完成本指南，您需要满足以下条件：

* 确保 FeatBit在本地或服务器上运行，详情请参阅[installation](../installation/full-installation.md)。
* 获取调用 REST API 的工具。以下是一些常见的选择：
  * [Curl](https://curl.se)
  * [Postman](https://www.postman.com/)
  * [FeatBit API 文档](overview.md)

#### Curl

[Curl](https://curl.se/) 是一个常用的命令行工具，用于发起 REST API 调用。本指南中的示例将使用 curl。您可以在自己的命令行界面中运行本指南中的示例。

#### Postman

[Postman](https://www.postman.com/) 平台是另一个用于发起 REST API 调用的选择。它提供了一套工具，用于设置、执行和存储 REST 请求。您可以创建一个免费的 Postman 账户，并在 Postman 客户端中运行本指南中的示例。

#### FeatBit API 文档

FeatBit API 文档提供了每个已记录请求的示例。

#### FeatBit 数据层次

FeatBit 账户可以包含一个或多个**项目**。项目可以包含多个**环境**，和**功能标志**存在于项目的某个环境中。创建新标志时，它仅在该环境中创建。所有标志配置设置都是特定于每个环境的。您在一个环境中所做的更改不会影响其他环境。如有需要，您可以为拥有的每个环境以独特的方式配置同一个标志。

许多软件项目会在每个项目里设置测试、预发布和生产环境。在 FeatBit 中，您可以根据组织的需求定义任何环境结构。例如，您的移动应用团队可能需要在“移动应用”项目中设置 android 测试、android 生产、iOS 测试和 iOS 生产环境。

### 设置请求头

您发出的每个请求都需要包含必要的头信息。头信息由键值对组成。包括 curl 和 Postman 在内的许多请求工具都可以在各个请求之间为您保存这些头信息。

<Callout type="info">
If you are using Postman, make sure the **Host** and **Content-Length** headers are selected. Those two headers are added automatically if you are using **curl** or other tools.
</Callout>


#### 必需的请求头

所有请求都必须包含 Authorization 请求头。此头部用于身份验证，以检查您是否有权对指定资源进行请求的操作。例如，如果您请求项目的信息，但没有该项目的读取权限，则会收到一个错误响应，表明您没有足够的权限。

`Authorization`头的值是一个API访问令牌。访问令牌可以是个人令牌或服务令牌。在FeatBit中，您可以在**集成/访问令牌**页面创建访问令牌。对于本指南，您需要一个具有功能标志**ManageFeatureFlag**权限的令牌，因此在创建令牌时请选择**ManageFeatureFlag**权限（默认已选中）。

要了解更多信息，请阅读[创建 API 访问令牌](../integrations/api-access-tokens.md)一节。

注意：您不能将 SDK 密钥用作访问令牌

对于所有包含请求正文的请求，API 要求必须有一个 Content-Type 请求头，其值为 application/json。如果请求不包括正文，API 将忽略 Content-Type 请求头。这意味着，即使 API 不要求，始终包含 Content-Type 请求头也是安全的。

要在 curl 中包含所需的请求头，请使用 -H 选项：

curl 示例

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/9d782f01-6ffb-4a7c-83a2-79304d801a46/feature-flags' \  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \  -H 'Content-Type: application/json'COPY
```

在此示例中，-X 选项指定了请求类型 PATCH。URL 指定了请求所作用的资源。每个 -H 选项指定了将包含在请求中的头信息。在使用 curl 发起请求时，您必须每次都包括 -X、请求类型、URL 和头信息。

### 练习：读取标志列表

#### 获取环境 ID

如前所述，功能标志是特定于环境的。要列出某个环境的功能标志，我们需要该环境的 ID（将来可能可以使用环境密钥来调用 API）。

获取环境 ID 的步骤如下：

1. 转到 **组织** 页面，点击 **项目** 标签页。
2. 在项目列表中找到您想要连接的项目和环境。
3. 点击**复制 ID**按钮，环境 id 会被复制到剪贴板

![](../api-docs/assets/using-featbit-rest-api/001.png)

#### 调用 API

使用前一步骤中获取的环境 ID，进行以下调用：

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/[YOUR ENVIRONMENT ID]/feature-flags?pageIndex=0&pageSize=10&isEnabled=' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN'
  -H 'Content-Type: application/json'
```

对此请求的响应是一个 200 成功代码，以及一个 JSON 对象，其中包含了该环境的所有功能标志的信息。例如：

```json
{
    "success": true,
    "errors": [],
    "data": {
        "totalCount": 1,
        "items": [
            {
                "id": "e3d78102-8a67-4698-a744-afcb005e8dfa",
                "name": "flag 1",
                "description": "",
                "key": "flag-1",
                "isEnabled": false,
                "variationType": "boolean",
                "variations": [
                    {
                        "id": "838b01b2-d443-4317-b8d3-adb2bed483c0",
                        "value": "true"
                    },
                    {
                        "id": "0c742a83-0053-4f37-8f34-9ef164c17875",
                        "value": "false"
                    }
                ],
                "updatedAt": "2023-03-20T05:44:15.765Z",
                "serves": {
                    "enabledVariations": [
                        "true"
                    ],
                    "disabledVariation": "false"
                },
                "tags": []
            }
        ]
    }
}
```
