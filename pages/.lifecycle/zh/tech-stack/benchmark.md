# 基准测试

FeatBit 的目标之一是创建一个可扩展且响应迅速的实时功能标志管理服务。在这方面，我们专注于处理并发用户的能力，这主要依赖于评估服务器服务的性能。本文档提供了评估服务器在隔离的最小环境中的性能报告。

## 测试目标

我们需要确定评估服务器是否满足以下指定的性能要求。

评估服务器需要能够每秒处理 1000 个新连接，并在响应时间和错误率方面提供行业标准级别的服务。第 99 百分位（P99）响应时间需要小于 200 毫秒，可接受的错误率小于 1%。有了这个标准，我们可以确保评估服务器的最大容量，同时提供高可靠性的服务。

本文档未涵盖 FeatBit 在给定时间内可以维持的最大用户连接数，因为我们观察到，在没有数据同步发生时，CPU 和内存的使用率很低。将变更推送给已连接用户的能力将在未来的报告中介绍。

## 一般测试条件

以下测试条件最适合模拟现实生活中的使用场景。

* 每秒建立的新连接数（包括数据同步）
* 平均 P99 响应时间 **（1）**
* 用户操作：在连接建立后发出数据同步请求

**（1）** 响应时间：指从发送数据同步请求到收到响应所经过的时间。

## 环境

我们选择了常用的 AWS EC2 服务来托管评估服务器服务。实例类型是 **t2.micro，配备 1 个 vCPU 和 1 GiB RAM**，符合免费套餐资格。

我们使用 EC2 实例来执行测试，以最大限度地减少网络对结果的影响。

## 执行的测试

**测试持续时间**：180 秒

**负载类型**：负载从 0 增加到每秒 1000、1100、1200 个新连接

**测试次数**：对每秒 1000、1100 和 1200 的情况分别进行了 10 次测试

## 测试结果

执行的测试显示，评估服务器只有在限定负载下才能保持所需的服务质量。在每秒 1100 个新连接时表现正常，但当达到每秒 1200 个连接时，观察到一些错误。

**响应时间**

<table><thead><tr><th width="378">每秒新连接数</th><th width="100">平均值 (ms)</th><th width="100">P95 (ms)</th><th>P99 (ms)</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>

**峰值 CPU 利用率 %**

| 每秒新连接数 | 爬坡阶段 | 稳定阶段 |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 82            | 26           |
| 1100                                 | 88            | 29           |
| 1200                                 | 91            | 31           |

**峰值内存利用率 %**

| 每秒新连接数 | 爬坡阶段 | 稳定阶段 |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 55            | 38           |
| 1100                                 | 58            | 42           |
| 1200                                 | 61            | 45           |

## 结论

在最低硬件配置下：**AWS EC2 t2.micro（1 vCPU + 1 GB RAM）**，评估服务器能够为每秒最多 1100 个新连接提供可靠服务，给定时间内维持的最大连接数可达 22000（这并非极限）。

测试期间测量的 Web 服务器资源利用率显示，硬件的瓶颈是 CPU，这是可以理解的，因为在数据同步阶段，CPU 被大量用于评估功能标志。通过使用具有更多 vCPU 的实例（或计算优化型实例），我们肯定可以提高每秒最大新连接数的容量。

我们相信，对于成本几乎可以忽略的小型企业来说，报告的性能已经足够（符合免费套餐资格）。随着业务的增长，可以通过水平扩展服务轻松地增加容量。&#x20;

## 用于测试的数据集

在上述测试中，我们使用了 5 个功能标志和 2 个细分市场。测试数据附在下方。

[功能标志测试样本文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[细分市场测试样本文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)
