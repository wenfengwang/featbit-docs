# 基准

FeatBit 的目标之一是创建一个可扩展且快速的实时功能标志管理服务。因此，我们专注于处理并发用户的能力，这主要取决于评估服务器服务的性能。该文档提供了评估服务器在隔离的最小环境中的性能报告。

## 测试目标

我们需要确定评估服务器是否满足以下指定的性能要求。

评估服务器需要能够处理每秒 1000 个新连接，以提供行业标准级别的服务，包括响应时间和错误率。第 99 百分位（P99）的响应时间需要小于 200 毫秒，可接受的错误率则应低于 1%。根据这一标准，我们将确保评估服务器在提供高可靠服务的同时，具备最大容量。

本文档未涵盖 FeatBit 在给定时间内可以保持的最大用户连接数，因为我们观察到，当没有发生数据同步时，CPU 和内存使用率较低。将更改推送给已连接用户的能力将在以后的报告中介绍。

## 一般测试条件

以下测试条件最适合模拟现实生活中的使用情况。

* 每秒建立的新连接数（包括数据同步）
* 平均 P99 响应时间 **(1)**
* 用户操作：建立连接后发出数据同步请求

**(1)** 响应时间：数据同步请求发送前和收到响应后经过的时间。

## 环境

我们选择了常用的 AWS EC2 服务来托管评估服务器服务。实例类型为 **t2.micro，配备 1 个 vCPU 和 1 GiB RAM**，符合免费套餐条件。

我们使用 EC2 实例来执行我们的测试，这可以最大限度地减少网络对结果的影响。

## 执行的测试

**测试持续时间**：180 秒

**负载类型**：从 0 到 1000、1100、1200 个新连接的逐渐增加

**测试次数**：每个每秒 1000、1100 和 1200 个新连接的情况各进行 10 次测试

## 测试结果

执行的测试表明，评估服务器仅在限制负载的情况下才能保持所需的服务质量。直到每秒 1100 个新连接，当达到 1200/s 时，会观察到一些错误。

**响应时间**

<table><thead><tr><th width="378">每秒新连接数</th><th width="100">平均值（毫秒）</th><th width="100">P95（毫秒）</th><th>P99（毫秒）</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>

**峰值 CPU 利用率百分比**

| 每秒新连接数 | 爬坡阶段 | 稳定阶段 |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 82            | 26           |
| 1100                                 | 88            | 29           |
| 1200                                 | 91            | 31           |

**峰值内存利用率百分比**

| 每秒新连接数 | 爬坡阶段 | 稳定阶段 |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 55            | 38           |
| 1100                                 | 58            | 42           |
| 1200                                 | 61            | 45           |

## 结论

在最低硬件设置下：**AWS EC2 t2.micro（1 vCPU + 1 G RAM）**，评估服务器能够提供可靠的服务，直到每秒 1100 个新连接，给定时间内保持的最大连接数达到 22000（这不是限制）。

测试期间测得的 Web 服务器资源利用率表明，硬件的瓶颈是 CPU，这是可以理解的，因为在数据同步阶段，CPU 被大量用于评估功能标志。通过使用具有更多 vCPU 的实例（或计算优化型实例），我们肯定可以增加每秒最大新连接数的容量。

我们认为，对于成本可以忽略不计的小型企业来说，报告的业绩基本上已经足够了（符合免费套餐条件）。随着业务的增长，通过横向扩展服务，可以轻松增加容量。&#x20;

## 用于测试的数据集

在上述测试中，我们使用了 5 个功能标志和 2 个段。测试数据附在下面。

[功能标志测试示例文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[段测试示例文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)

