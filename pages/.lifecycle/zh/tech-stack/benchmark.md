
# 基准

FeatBit 的一项目标是创建一个可扩展且响应迅速的实时功能标志管理服务。在这方面，我们专注于处理并发用户的能力，这主要取决于评估服务器服务的表现。本文档提供了评估服务器在隔离的最小化环境下的性能报告。

## 测试目标

我们需要确定评估服务器是否满足以下特定的性能要求。

评估服务器需要能够每秒处理 1000 个新连接，并在响应时间与错误率方面提供业界标准水平的服务。第 99 百分位（P99）响应时间需要小于 200 毫秒，且可接受的错误率应小于 1%。根据这个标准，我们可以确保评估服务器的最大处理能力，同时提供高度可靠的服务。

本文档中没有涵盖 FeatBit 在特定时间内可以维持的最大用户连接数，因为我们注意到在没有数据同步发生时，CPU 和内存的使用率都很低。将来的报告将会包含向已连接用户推送更改的能力。

## 常规测试条件

以下测试条件最适合模拟现实生活中的使用场景。

* 每秒建立的新连接数量（包括数据同步）
* 平均 P99 响应时间 **(1)**
* 用户操作：在建立连接后发起数据同步请求

**(1)** 响应时间：指从发送数据同步请求到收到响应所经过的时间。

## 环境

我们选择了常用的 AWS EC2 服务来部署评估服务器服务。实例类型为 **t2.micro with 1 vCPU and 1 GiB RAM**，配备 1 个 vCPU 和 1 GiB RAM，符合免费套餐资格。

我们使用 EC2 实例进行测试，以此最大限度地减少网络对结果的影响。

## 已进行的测试

**测试持续时间**：180 秒

**负载类型**：从每秒 0 逐渐增加至 1000、1100、1200 个新连接

**测试数量**：每个用例（每秒 1000、1100 和 1200 个新连接）进行 10 次测试

## 测试结果

进行的测试显示，评估服务器只有在负载有限的情况下才能保持期望的服务质量。当新连接数达到每秒 1100 个时，服务质量仍然维持不错；但当增至 1200 个/秒时，便观察到一些错误。

**响应时间**

<table><thead><tr><th width="378">Number of new connections per second</th><th width="100">Avg (ms)</th><th width="100">P95 (ms)</th><th>P99 (ms)</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>


**CPU 峰值使用率百分比**

|每秒新增连接数|上升阶段|稳定阶段|
|---|---|---|
|1000|82|26|
|1100|88|29|
|1200|91|31|

**内存峰值使用率百分比**

|每秒新增连接数|上升阶段|稳定阶段|
|---|---|---|
|1000|55|38|
|1100|58|42|
|1200|61|45|

## 结论

在最低硬件配置下：**AWS EC2 t2.micro (1 vCPU + 1 GB RAM)**，评估服务器能够在每秒 1100 个新连接的情况下提供可靠服务，且在特定时间内能维持的最大连接数可达到 22000（这并非上限）。

测试期间测量的 Web 服务器资源使用情况表明，硬件的瓶颈在于 CPU，这是合理的，因为在数据同步阶段，CPU 需要大量用于评估功能标志。通过使用具有更多 vCPU（或优化计算的实例），我们肯定可以提高每秒最大新连接数的容量。

我们相信，对于成本几乎可以忽视的小型企业（符合免费套餐资格），所报告的性能已经足够。随着业务的增长，可以通过水平扩展服务来轻松扩大容量。

## 用于测试的数据集

在上述测试中，我们使用了 5 个功能标志和 2 个细分市场。以下附上测试数据样本。

[Feature flags test sample file](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[Segments test sample file](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)
