import { Callout } from 'nextra/components'

# DataDog

FeatBit æä¾›ä»¥ä¸‹ä¸ DataDog é›†æˆçš„æ–¹æ³•ï¼š

1. [ä½¿ç”¨ Datadog RUM é›†æˆ](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum) å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogã€‚
2. [ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ](https://docs.datadoghq.com/api/?lang=bash#events) ä» FeatBit æ¥æ”¶æ´»åŠ¨ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°ã€‚
3. ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨åœ¨ DataDog æŒ‡æ ‡ä½äºç‰¹å®šé˜ˆå€¼æ—¶å›æ»šåŠŸèƒ½æ ‡å¿—ã€‚
4. å°†åŠŸèƒ½æ ‡å¿—è§è§£å¯¼å‡ºåˆ° DataDog APMã€‚

## ä½¿ç”¨ Datadog RUM é›†æˆ

[åŠŸèƒ½æ ‡å¿—è·Ÿè¸ª](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/) å¯è®©æ‚¨é€šè¿‡ç¡®å®šå‘å“ªäº›ç”¨æˆ·æ˜¾ç¤ºç‰¹å®šåŠŸèƒ½ä»¥åŠæ‚¨å¼•å…¥çš„ä»»ä½•æ›´æ”¹æ˜¯å¦ä¼šå½±å“ç”¨æˆ·ä½“éªŒæˆ–å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œä»è€Œæ›´æ·±å…¥åœ°äº†è§£ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ç›‘æ§ã€‚

### è®¾ç½®åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†

è¦å¼€å§‹ï¼Œæ‚¨éœ€è¦[è®¾ç½® DataDog åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection)ã€‚å¯¹äº **javascript/typescript** é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆå§‹åŒ– RUM SDKï¼Œå¹¶ä½¿ç”¨ `enableExperimentalFeatures` å‚æ•°é…ç½®ä¸º `["feature_flags"]`ã€‚è¿™å°†å¯ç”¨ç‰¹å¾æ ‡å¿—è·Ÿè¸ªåŠŸèƒ½ï¼Œå¹¶å°†ç‰¹å¾æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogã€‚

```javascript
datadogRum.init({
  applicationId: "sample-application-id",
  clientToken: "sample-client-token",
  site: "datadoghq.com",
  service: "demo-app",
  env: "dev",
  version: "1.0.0",
  sessionSampleRate: 100,
  sessionReplaySampleRate: 100,
  trackUserInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  defaultPrivacyLevel: "mask-user-input",
  // This enables the beta feature flag tracking
  enableExperimentalFeatures: ["feature_flags"]
});

datadogRum.startSessionReplayRecording();
```

ç„¶åï¼Œåœ¨è¯„ä¼° `FeatBit` åŠŸèƒ½æ ‡å¿—æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ datadogRum åŒ…ä¸­å†…ç½®çš„ `addFeatureFlagEvaluation` æ–¹æ³•ã€‚

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

const flagEvalResult = fbClient.variation("feature-flag-key", flagsDefaultValues[prop] || '')
datadogRum.addFeatureFlagEvaluation("feature-flag-key", flagEvalResult);
```

å¦‚æœæ‚¨ä¸æƒ³åœ¨å„å¤„ç¼–å†™ä¸¤è¡Œä»£ç ï¼Œå¯ä»¥å°† `.variation(...)` å’Œ `.addFeatureFlagEvaluation(...)` å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ [React ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-react/src/featBit/featBitSlice.js) å’Œ [Vue ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-vue/src/featbit.js) é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `Flags Proxy` æ¥æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥è·å–åŠŸèƒ½æ ‡å¿—å€¼ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å°† addFeatureFlagEvaluation æ·»åŠ åˆ° Flags Proxy ä¸­ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨å®ƒï¼š

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

export const createFlagsProxy = () => {
    return new Proxy({}, {
        get(target, prop, _) {
          let returnValue = ''
          if(typeof prop === 'string' && !prop.startsWith('__v_')){
            returnValue = fbClient.variation(prop, flagsDefaultValues[prop] || '');
            datadogRum.addFeatureFlagEvaluation(prop, returnValue);
          }
          return returnValue;
        }
    })
}
```

å› æ­¤ï¼Œå½“æ‚¨åœ¨ä»£ç ä¸­è°ƒç”¨åŠŸèƒ½æ ‡å¿—æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š

```javascript
// Vue ç¤ºä¾‹ä¸­ä½¿ç”¨ Piniaï¼Œä¸‹é¢çš„ä»£ç è¿˜å¯ä»¥ä¿è¯åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
<DinoGameCore v-if="featBitStore.flags['game-runner']== true"
              :difficulty="featBitStore.flags['difficulty-mode']" />

// React ç¤ºä¾‹ä¸­ä½¿ç”¨ Reduxï¼Œä¸‹é¢çš„ä»£ç è¿˜å¯ä»¥ä¿è¯åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
featureFlags["game-runner"] == true ? 
  <DinoGameCore difficulty={featureFlags["difficulty-mode"]} /> : <>

```


<Callout type="info">
**æ³¨æ„**ï¼šä¸Šé¢çš„æ•™ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ”¶é›†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®ã€‚å¯¹äº iOS å’Œ Android ç­‰å…¶ä»–å¹³å°ï¼Œè¯·å‚é˜… [DataDog æ–‡æ¡£](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=ios#custom-feature-flag-management)ã€‚
</Callout>


### åˆ†æ RUM å’Œ APM ä¸­çš„åŠŸèƒ½æ ‡å¿—æ€§èƒ½


å°† FeatBit ä¸ DataDog é›†æˆåï¼Œæ‚¨å¯ä»¥åœ¨ [RUM ä¸­åˆ†æåŠŸèƒ½æ ‡å¿—çš„æ€§èƒ½](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DataDog çš„ RUM ä»ªè¡¨æ¿è¿‡æ»¤ **ä¼šè¯**ã€**è§†å›¾** å’Œ **é”™è¯¯**ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…æ‰¾åˆ°åœ¨è¯„ä¼° FeatBit çš„è§†å›¾ä¸­å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](../integrations/assets/datadog/filter-errors-with-feature-flag-in-rum.webp)

è¦æŸ¥çœ‹å’Œåˆ†ææ‚¨çš„åŠŸèƒ½æ ‡å¿—ï¼Œè¯·å‚é˜… [DataDog ç‰¹å¾æ ‡å¿—è·Ÿè¸ªæ•™ç¨‹](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/#view-your-feature-flags)ã€‚

å¦‚æœæ‚¨ä½¿ç”¨ [DataDog APM](https://www.datadoghq.com/product/apm/)ï¼ŒDataDog æä¾›äº†ä¸€ç§å°†å‰ç«¯åŠŸèƒ½æ ‡å¿—æ•°æ®è¿æ¥åˆ°è·Ÿè¸ªçš„æ–¹æ³•ã€‚è¯·å‚é˜… [è¿æ¥ RUM å’Œè·Ÿè¸ª](https://docs.datadoghq.com/real_user_monitoring/connect_rum_and_traces/?tab=browserrum)ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥æ ¹æ®å‰ç«¯å’Œåç«¯é”™è¯¯å‘å‡ºè­¦æŠ¥ã€‚

## ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ

Datadog é›†æˆå…è®¸æ‚¨è®¾ç½® [Datadog äº‹ä»¶](https://docs.datadoghq.com/api) ä»¥æ¥æ”¶æ¥è‡ª FeatBit çš„ä»»ä½•æ´»åŠ¨ã€‚å½“å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°æˆ–å‘ FeatBit æ·»åŠ æ–°å¸æˆ·æˆå‘˜ï¼ŒFeatBit ä¼šå‘ Datadog å‘é€äº‹ä»¶ã€‚ä½¿ç”¨æ­¤é›†æˆæ¥å…³è”å’Œäº†è§£å¯¹ FeatBit ä¸­åŠŸèƒ½çš„æ›´æ”¹å¦‚ä½•å½±å“æ‚¨çš„åº”ç”¨å’ŒåŸºç¡€æ¶æ„æŒ‡æ ‡ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨æœåŠ¡ APM ä»ªè¡¨æ¿ä¸­å‘ç°çš„åŠŸèƒ½æ ‡å¿—äº‹ä»¶ä¸æ•…éšœæ£€æµ‹ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å…³é—­åŠŸèƒ½æ ‡å¿—åï¼Œä¸­æ–­æ¶ˆå¤±äº†ã€‚

![](../integrations/assets/datadog/dashboard-apm-error-turn-off-events.png)

å®Œæ•´çš„æ´»åŠ¨é›†æˆä»åœ¨è¿›è¡Œä¸­ã€‚ä½†æ˜¯æ‚¨ç›®å‰å¯ä»¥ç¼–å†™è‡ªå·±çš„ç¨‹åºæ¥ç›‘è§†æˆ‘ä»¬çš„ MongoDB `AuditLogs` é›†åˆä¸­çš„äº‹ä»¶æ›´æ”¹ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•[åœ¨ .NET ä¸­ç›‘è§†é›†åˆæ›´æ”¹çš„å®˜æ–¹æ•™ç¨‹](https://mongodb.github.io/mongo-csharp-driver/2.7/reference/driver/change_streams/)ã€‚

![](../integrations/assets/datadog/mongodb-auditlog-collection.png)

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [DataDog äº‹ä»¶ API](https://docs.datadoghq.com/api/latest/events/#post-an-event) å°†æ´»åŠ¨å‘é€åˆ° DataDogã€‚ 

<Callout type="info" emoji='ğŸ’¡'>å¦‚æœæ‚¨å¸Œæœ›æˆ‘ä»¬åŠ é€Ÿæ­¤å®ç°çš„åŠŸèƒ½å¼€å‘ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ã€‚</Callout>


## ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨ä¸ Datadog

[DataDog çš„ Webhook](https://docs.datadoghq.com/integrations/webhooks/) å…è®¸æ‚¨åœ¨è§¦å‘æŒ‡æ ‡è­¦æŠ¥æ—¶é€šçŸ¥æ‚¨çš„æœåŠ¡ã€‚åœ¨ Webhook é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ç›´æ¥è°ƒç”¨ [FeatBit æ ‡å¿—è§¦å‘å™¨](../feature-flags/feature-workflow/flag-triggers) æ¥åˆ‡æ¢åŠŸèƒ½æ ‡å¿—çš„å¼€å…³ï¼Œæˆ–è°ƒç”¨ [FeatBit REST API](../api-docs/using-featbit-rest-api) æ¨å‡º/å›æ»šåˆ°ç‰¹å®šç”¨æˆ·ç»„ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é…ç½® Webhook ä»¥è°ƒç”¨æ ‡å¿—è§¦å‘å™¨ï¼š

1. æ‚¨éœ€è¦é¦–å…ˆåœ¨åŠŸèƒ½æ ‡å¿—ä¸­åˆ›å»ºæ ‡å¿—è§¦å‘å™¨ã€‚è¯·å‚é˜… [å·¥ä½œæµ/æ ‡å¿—è§¦å‘å™¨](/feature-flags/feature-workflow/flag-triggers)ã€‚

![](../integrations/assets/datadog/flag-trigger.png)

2. åœ¨ DataDog é›†æˆä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ WebHookï¼Œå¹¶åœ¨æ–°çš„ WebHook ä¸­å¤åˆ¶æ ‡å¿—è§¦å‘å™¨ URLã€‚

![](../integrations/assets/datadog/create-webhook.png)

3. è½¬åˆ°â€œç›‘è§†â€é¡µé¢ï¼Œåˆ›å»ºåŒ…å«æœç´¢æŸ¥è¯¢å’Œæ¡ä»¶çš„æŒ‡æ ‡ã€‚ç„¶åæ·»åŠ  `@webhook-name_of_the_webhook` åˆ°è­¦æŠ¥æ–‡æœ¬ä¸­ã€‚å½“æŒ‡æ ‡ä½äºæ¡ä»¶ä¸­è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°†è§¦å‘ Webhookã€‚

![](../integrations/assets/datadog/monitor-notify-team.png)

4. è§¦å‘ WebHook åï¼ŒåŠŸèƒ½æ ‡å¿—ä¼šè‡ªåŠ¨åˆ‡æ¢å¼€å…³ã€‚

## å°†åŠŸèƒ½æ ‡å¿—è§è§£å¯¼å‡ºåˆ° DataDog APM

Datadog æä¾›äº†å„ç§å·¥å…·å’ŒåŠŸèƒ½ï¼Œç”¨äºç›‘è§†åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨ **æŒ‡æ ‡** ä¸€ç›®äº†ç„¶åœ°è¯„ä¼°ç¯å¢ƒçš„è¿è¡ŒçŠ¶å†µã€‚ä¾‹å¦‚ï¼Œå¯è§†åŒ–ç”¨æˆ·åŠ è½½æ‚¨ç½‘ç«™çš„é€Ÿåº¦ï¼Œæˆ–æœåŠ¡å™¨çš„å¹³å‡å†…å­˜æ¶ˆè€—ã€‚ç¡®å®šé—®é¢˜åï¼Œå¯ä»¥ä½¿ç”¨ **æ—¥å¿—** å’Œ **è·Ÿè¸ª** æ¥è¿›ä¸€æ­¥æ’é™¤æ•…éšœã€‚

åœ¨ä¸Šè¿°å‘ APM å‘é€æ´»åŠ¨äº‹ä»¶çš„é™„åŠ å†…å®¹ä¸­ï¼ˆä½¿ç”¨ [Datadog äº‹ä»¶é›†æˆï¼‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ ](#using-the-datadog-events-integration) Pro ç‰ˆæˆ–æ ‡å‡†ç‰ˆä¸­çš„ **MongoDB** å°† FeatBit çš„åŠŸèƒ½æ ‡å¿—è§è§£æ•°æ®ï¼ˆåŒ…æ‹¬å‰ç«¯å’Œåç«¯åŠŸèƒ½æ ‡å¿—ä½¿ç”¨æ•°æ®ï¼‰å’Œè‡ªå®šä¹‰äº‹ä»¶æ•°æ®å¯¼å‡ºåˆ° DataDogã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹© Metrics ï¼ˆæŒ‡æ ‡ï¼‰ æ¥æ¦‚è¿°æ ‡å¿—ä½¿ç”¨æƒ…å†µï¼ˆè®¡æ•°ã€é«˜çº§å½±å“ï¼‰å’Œ Traces ï¼ˆè·Ÿè¸ªï¼‰ ä»¥æ·±å…¥äº†è§£æ ‡å¿—å¦‚ä½•å½±å“å•ä¸ªè¯·æ±‚ã€‚åŒæ—¶ä½¿ç”¨æŒ‡æ ‡å’Œè·Ÿè¸ªå¯ä»¥æä¾›åŠŸèƒ½æ ‡å¿—è¡Œä¸ºå’Œåº”ç”¨ç¨‹åºæ€§èƒ½çš„å…¨é¢è§†å›¾ã€‚

**å¦‚æœæ‚¨å¯¹æ­¤å®ç°æœ‰ä»»ä½•æƒ³æ³•ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¶åˆ°æ‚¨çš„æ¥ä¿¡**ã€‚