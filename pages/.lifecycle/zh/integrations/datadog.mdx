
ä» 'nextra/components' å¯¼å…¥ { Callout }

# DataDog

FeatBit æä¾›ä»¥ä¸‹æ–¹æ³•ä¸ DataDog é›†æˆï¼š

1. ä½¿ç”¨ [Datadog RUM é›†æˆ](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum) å‘é€åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®è‡³ DataDogã€‚
2. [ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ](https://docs.datadoghq.com/api/?lang=bash#events)æ¥æ”¶æ¥è‡ª FeatBit çš„æ´»åŠ¨ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°ã€‚
3. ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨ï¼Œå½“ DataDog æŒ‡æ ‡é™è‡³æŸé˜ˆå€¼ä»¥ä¸‹æ—¶å›æ»šåŠŸèƒ½æ ‡å¿—ã€‚
4. å°†åŠŸèƒ½æ ‡å¿—æ´å¯Ÿå¯¼å‡ºè‡³ DataDog APMã€‚

## ä½¿ç”¨ Datadog RUM é›†æˆ

[Feature Flag Tracking](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/)è®©æ‚¨æ›´æ¸…æ¥šåœ°äº†è§£æ‚¨çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ç›‘æ§ï¼Œé€šè¿‡å…è®¸æ‚¨ç¡®å®šå“ªäº›ç”¨æˆ·æ­£åœ¨æ˜¾ç¤ºç‰¹å®šåŠŸèƒ½ï¼Œä»¥åŠæ‚¨å¼•å…¥çš„ä»»ä½•å˜åŒ–æ˜¯å¦å½±å“äº†ç”¨æˆ·ä½“éªŒæˆ–å¯¹æ€§èƒ½äº§ç”Ÿäº†è´Ÿé¢å½±å“ã€‚

### è®¾ç½®åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†

é¦–å…ˆï¼Œæ‚¨éœ€è¦è®¾ç½® [DataDog çš„åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection)ã€‚å¯¹äº **JavaScript/TypeScript** é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆå§‹åŒ– RUM SDK å¹¶é…ç½® `enableExperimentalFeatures` åˆå§‹åŒ–å‚æ•°ä¸º `["feature_flags"]`ã€‚è¿™å°†å¯ç”¨åŠŸèƒ½æ ‡å¿—è·Ÿè¸ªåŠŸèƒ½ï¼Œå¹¶å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€è‡³ DataDogã€‚

```javascript
datadogRum.init({
  applicationId: "sample-application-id",
  clientToken: "sample-client-token",
  site: "datadoghq.com",
  service: "demo-app",
  env: "dev",
  version: "1.0.0",
  sessionSampleRate: 100,
  sessionReplaySampleRate: 100,
  trackUserInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  defaultPrivacyLevel: "mask-user-input",
  // This enables the beta feature flag tracking
  enableExperimentalFeatures: ["feature_flags"]
});

datadogRum.startSessionReplayRecording();
```

æ¥ç€ï¼Œæ‚¨å¯ä»¥åœ¨è¯„ä¼° FeatBit åŠŸèƒ½æ ‡å¿—æ—¶ï¼Œä½¿ç”¨ datadogRum åŒ…å†…ç½®çš„ addFeatureFlagEvaluation æ–¹æ³•ã€‚

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

const flagEvalResult = fbClient.variation("feature-flag-key", flagsDefaultValues[prop] || '')
datadogRum.addFeatureFlagEvaluation("feature-flag-key", flagEvalResult);
```

å¦‚æœæ‚¨ä¸æƒ³åœ¨æ¯ä¸ªåœ°æ–¹éƒ½å†™ä¸¤è¡Œä»£ç ï¼Œå¯ä»¥å°† `.variation(...)` å’Œ `.addFeatureFlagEvaluation(...)` å°è£…è¿›ä¸€ä¸ªå‡½æ•°ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ [React ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-react/src/featBit/featBitSlice.js) å’Œ [Vue ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-vue/src/featbit.js) é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† `Flags Proxy` æ¥æä¾›è·å–åŠŸèƒ½æ ‡å¿—å€¼çš„ç»Ÿä¸€æ¥å£ã€‚æ‰€ä»¥æ‚¨å¯ä»¥å°† addFeatureFlagEvaluation åŠ å…¥åˆ° Flags Proxy ä¸­ï¼Œå¹¶åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

export const createFlagsProxy = () => {
    return new Proxy({}, {
        get(target, prop, _) {
          let returnValue = ''
          if(typeof prop === 'string' && !prop.startsWith('__v_')){
            returnValue = fbClient.variation(prop, flagsDefaultValues[prop] || '');
            datadogRum.addFeatureFlagEvaluation(prop, returnValue);
          }
          return returnValue;
        }
    })
}
```

è¿™æ ·ï¼Œå½“æ‚¨åœ¨ä»£ç ä¸­è°ƒç”¨ feature flag æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š

```javascript
// Vue example with Pinia, code below also guarantees the real-time update of the feature flag value
<DinoGameCore v-if="featBitStore.flags['game-runner']== true"
              :difficulty="featBitStore.flags['difficulty-mode']" />

// React example with Redux, code below also guarantees the real-time update of the feature flag value
featureFlags["game-runner"] == true ? 
  <DinoGameCore difficulty={featureFlags["difficulty-mode"]} /> : <>

```

<Callout type="info">
**NOTE**: The tutorial above showed how to collect feature flag evaluation data in the browser. For other platforms such as iOS and Android, please refer to the [DataDog documentation](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=ios#custom-feature-flag-management).
</Callout>


### åœ¨ RUM å’Œ APM ä¸­åˆ†ææ‚¨çš„åŠŸèƒ½æ ‡å¿—æ€§èƒ½

å°† FeatBit ä¸ DataDog é›†æˆåï¼Œæ‚¨å¯ä»¥[åœ¨ RUM ä¸­åˆ†æåŠŸèƒ½æ ‡å¿—çš„æ€§èƒ½](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DataDog çš„ RUM ä»ªè¡¨æ¿è¿‡æ»¤**ä¼šè¯**ã€**è§†å›¾**å’Œ**é”™è¯¯**ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…ï¼Œå‘ç”Ÿåœ¨è¯„ä¼°äº†æ‚¨çš„ FeatBit åŠŸèƒ½æ ‡å¿—çš„è§†å›¾ä¸­çš„æ‰€æœ‰é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](../integrations/assets/datadog/filter-errors-with-feature-flag-in-rum.webp)

è¦æŸ¥çœ‹å’Œåˆ†ææ‚¨çš„åŠŸèƒ½æ ‡å¿—ï¼Œè¯·å‚è€ƒ [DataDogåŠŸèƒ½æ ‡å¿—è·Ÿè¸ªæ•™ç¨‹](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/#view-your-feature-flags)ã€‚

å¦‚æœæ‚¨ä½¿ç”¨ [DataDog APM](https://www.datadoghq.com/product/apm/)ï¼ŒDataDog æä¾›äº†ä¸€ç§æ–¹æ³•å°†å‰ç«¯åŠŸèƒ½æ ‡å¿—æ•°æ®ä¸æ‚¨çš„è¿½è¸ªè¿æ¥èµ·æ¥ã€‚å‚è§[è¿æ¥ Rum å’Œ Traces](https://docs.datadoghq.com/real_user_monitoring/connect_rum_and_traces/?tab=browserrum)ã€‚è¿™æ ·æ‚¨å¯ä»¥åŸºäºå‰ç«¯å’Œåç«¯çš„é”™è¯¯è®¾ç½®è­¦æŠ¥ã€‚

## ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ

Datadog é›†æˆè®©æ‚¨å¯ä»¥è®¾ç½® [Datadog äº‹ä»¶](https://docs.datadoghq.com/api) ä»¥æ¥æ”¶ FeatBit çš„ä»»ä½•æ´»åŠ¨ã€‚å½“æœ‰å˜åŠ¨å‘ç”Ÿæ—¶ï¼Œå¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°æˆ–æ–°è´¦æˆ·æˆå‘˜è¢«æ·»åŠ è‡³ FeatBitï¼ŒFeatBit ä¼šå‘ Datadog å‘é€äº‹ä»¶ã€‚åˆ©ç”¨è¿™ä¸ªé›†æˆï¼Œæ‚¨å¯ä»¥å…³è”å¹¶ç†è§£å¦‚ä½•æ”¹å˜æ‚¨åœ¨ FeatBit ä¸­çš„åŠŸèƒ½ä¼šå½±å“æ‚¨çš„åº”ç”¨å’ŒåŸºç¡€è®¾æ–½æŒ‡æ ‡ã€‚

ä¸‹é¢çš„å›¾ç‰‡å±•ç¤ºäº†åŠŸèƒ½æ ‡å¿—äº‹ä»¶ä¸æœåŠ¡ APM ä»ªè¡¨æ¿ä¸­å¤±è´¥æ£€æµ‹ä¹‹é—´çš„å…³è”ã€‚å…³é—­åŠŸèƒ½æ ‡å¿—åï¼Œæ•…éšœæ¶ˆå¤±äº†ã€‚

![](../integrations/assets/datadog/dashboard-apm-error-turn-off-events.png)

å®Œæ•´çš„äº‹ä»¶é›†æˆä»åœ¨å¼€å‘ä¸­ã€‚ä½†æ‚¨å½“å‰å¯ä»¥ç¼–å†™è‡ªå·±çš„ç¨‹åºæ¥ç›‘æ§æˆ‘ä»¬çš„ MongoDB `AuditLogs` é›†åˆä¸­çš„äº‹ä»¶å˜åŒ–ã€‚è¿™æ˜¯ä¸€ä¸ªå®˜æ–¹æ•™ç¨‹ï¼Œè¯´æ˜äº†å¦‚ä½•åœ¨ [.NET](https://mongodb.github.io/mongo-csharp-driver/2.7/reference/driver/change_streams/) ä¸­ç›‘æ§é›†åˆå˜åŒ–ã€‚

![](../integrations/assets/datadog/mongodb-auditlog-collection.png)

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[DataDog Events API](https://docs.datadoghq.com/api/latest/events/#post-an-event)å°†æ´»åŠ¨å‘é€è‡³ DataDogã€‚

<Callout type="info" emoji='ğŸ’¡'>
Please let us know if you would like us to accelerate feature development for this implementation.
</Callout>


## ä¸ Datadog ä¸€èµ·ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨

[DataDog's Webhook](https://docs.datadoghq.com/integrations/webhooks/) å…è®¸æ‚¨åœ¨æŒ‡æ ‡è­¦æŠ¥è§¦å‘æ—¶é€šçŸ¥æ‚¨çš„æœåŠ¡ã€‚åœ¨ Webhook é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ç›´æ¥è°ƒç”¨[FeatBit Flag Trigger](../feature-flags/feature-workflow/flag-triggers)æ¥åˆ‡æ¢åŠŸèƒ½æ ‡å¿—çš„å¼€/å…³çŠ¶æ€ï¼Œæˆ–è€…è°ƒç”¨[FeatBit REST API](../api-docs/using-featbit-rest-api)å¯¹ç‰¹å®šç”¨æˆ·ç¾¤ä½“è¿›è¡Œå‘å¸ƒ/å›æ»šã€‚ä»¥ä¸‹æ˜¯é…ç½® Webhook è°ƒç”¨æ ‡å¿—è§¦å‘å™¨çš„æ–¹æ³•ï¼š

1. æ‚¨éœ€è¦é¦–å…ˆåœ¨åŠŸèƒ½æ ‡å¿—ä¸­åˆ›å»ºä¸€ä¸ªæ ‡å¿—è§¦å‘å™¨ã€‚å‚è§[å·¥ä½œæµ/æ ‡å¿—è§¦å‘å™¨](/feature-flags/feature-workflow/flag-triggers)ã€‚

![](../integrations/assets/datadog/flag-trigger.png)

2. åœ¨ DataDog é›†æˆä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Webhook å¹¶å¤åˆ¶æ–° Webhook ä¸­çš„æ ‡å¿—è§¦å‘å™¨ URLã€‚

![](../integrations/assets/datadog/create-webhook.png)

3. è½¬åˆ°ç›‘æ§é¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªå¸¦æœ‰æœç´¢æŸ¥è¯¢å’Œæ¡ä»¶çš„æŒ‡æ ‡ã€‚ç„¶ååœ¨è­¦æŠ¥æ–‡æœ¬ä¸­æ·»åŠ  @webhook-name_of_the_webhookã€‚å½“æŒ‡æ ‡ä½äºæ¡ä»¶ä¸­è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°†è§¦å‘ Webhookã€‚

![](../integrations/assets/datadog/monitor-notify-team.png)

4. è§¦å‘ Webhook åï¼ŒåŠŸèƒ½æ ‡å¿—å°†è‡ªåŠ¨åˆ‡æ¢å¼€/å…³ã€‚

## å°†åŠŸèƒ½æ ‡å¿—æ´å¯Ÿå¯¼å‡ºè‡³ DataDog APM

DataDog æä¾›äº†å¤šç§å·¥å…·å’ŒåŠŸèƒ½ï¼Œç”¨äºç›‘æ§åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨**æŒ‡æ ‡**å¿«é€Ÿäº†è§£ç¯å¢ƒçš„å¥åº·çŠ¶å†µã€‚ä¾‹å¦‚ï¼Œå¯è§†åŒ–ç”¨æˆ·åŠ è½½ç½‘ç«™çš„é€Ÿåº¦æˆ–æœåŠ¡å™¨çš„å¹³å‡å†…å­˜æ¶ˆè€—ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨**æ—¥å¿—**å’Œ**è¿½è¸ª**è¿›ä¸€æ­¥æ’æŸ¥æ•…éšœã€‚

é™¤äº†å¦‚ä¸Šæ‰€è¿°å°†æ´»åŠ¨äº‹ä»¶å‘é€è‡³ APMï¼ˆ[ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ](#using-the-datadog-events-integration)ï¼‰ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨é«˜çº§ç‰ˆä¸­ä½¿ç”¨ **ClickHouse** æˆ–æ ‡å‡†ç‰ˆä¸­ä½¿ç”¨ **MongoDB**ï¼Œå°† FeatBit çš„åŠŸèƒ½æ ‡å¿—æ´å¯Ÿæ•°æ®ï¼ˆå‰ç«¯å’Œåç«¯åŠŸèƒ½æ ‡å¿—ä½¿ç”¨æ•°æ®ï¼‰åŠè‡ªå®šä¹‰äº‹ä»¶æ•°æ®å¯¼å‡ºè‡³ DataDog APM å’Œ Metricsï¼Œå®ç°æ·±åº¦é›†æˆã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹©æŒ‡æ ‡æ¥æ¦‚è§ˆæ ‡å¿—ä½¿ç”¨æƒ…å†µï¼ˆè®¡æ•°ã€é«˜å±‚å½±å“ï¼‰ï¼Œä»¥åŠé€‰æ‹©è¿½è¸ªæ¥æ·±å…¥äº†è§£æ ‡å¿—å¦‚ä½•å½±å“æ¯ä¸ªè¯·æ±‚ã€‚ç»“åˆä½¿ç”¨æŒ‡æ ‡å’Œè¿½è¸ªï¼Œå¯ä»¥å…¨é¢äº†è§£åŠŸèƒ½æ ‡å¿—è¡Œä¸ºå’Œåº”ç”¨æ€§èƒ½ã€‚

**å¦‚æœæ‚¨å¯¹è¿™ç§å®ç°æœ‰ä»»ä½•æƒ³æ³•**ï¼Œæˆ‘ä»¬æœŸå¾…æ”¶åˆ°æ‚¨çš„åé¦ˆã€‚
