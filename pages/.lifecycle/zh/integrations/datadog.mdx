import { Callout } from 'nextra/components'

# DataDog

FeatBit æä¾›ä»¥ä¸‹æ–¹æ³•ä¸ DataDog é›†æˆï¼š

1. [ä½¿ç”¨ Datadog RUM é›†æˆ](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)å‘é€åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®åˆ° DataDogã€‚
2. [ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ](https://docs.datadoghq.com/api/?lang=bash#events)æ¥æ”¶æ¥è‡ª FeatBit çš„æ´»åŠ¨ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°ã€‚
3. ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨å›æ»šåŠŸèƒ½æ ‡å¿—ï¼Œå¦‚æœ DataDog æŒ‡æ ‡ä½äºç‰¹å®šé˜ˆå€¼ã€‚
4. å°†åŠŸèƒ½æ ‡å¿—è§è§£å¯¼å‡ºåˆ° DataDog APMã€‚

## ä½¿ç”¨ Datadog RUM é›†æˆ

[åŠŸèƒ½æ ‡å¿—è·Ÿè¸ª](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/)å¯ä»¥è®©æ‚¨ç¡®å®šå“ªäº›ç”¨æˆ·çœ‹åˆ°äº†ç‰¹å®šåŠŸèƒ½ï¼Œä»¥åŠæ‚¨å¼•å…¥çš„ä»»ä½•æ›´æ”¹æ˜¯å¦å½±å“ç”¨æˆ·ä½“éªŒæˆ–æ€§èƒ½ã€‚

### è®¾ç½®åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†

é¦–å…ˆï¼Œæ‚¨éœ€è¦[è®¾ç½® DataDog åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection)ã€‚å¯¹äº **JavaScript/TypeScript** é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆå§‹åŒ– RUM SDKï¼Œå¹¶é…ç½® `enableExperimentalFeatures` åˆå§‹åŒ–å‚æ•°ä¸º `["feature_flags"]`ã€‚è¿™å°†å¯ç”¨åŠŸèƒ½æ ‡å¿—è·Ÿè¸ªåŠŸèƒ½ï¼Œå¹¶å‘é€åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®åˆ° DataDogã€‚

```javascript
datadogRum.init({
  applicationId: "sample-application-id",
  clientToken: "sample-client-token",
  site: "datadoghq.com",
  service: "demo-app",
  env: "dev",
  version: "1.0.0",
  sessionSampleRate: 100,
  sessionReplaySampleRate: 100,
  trackUserInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  defaultPrivacyLevel: "mask-user-input",
  // å¯ç”¨ beta ç‰ˆåŠŸèƒ½æ ‡å¿—è·Ÿè¸ª
  enableExperimentalFeatures: ["feature_flags"]
});

datadogRum.startSessionReplayRecording();
```

ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨è¯„ä¼° `FeatBit` åŠŸèƒ½æ ‡å¿—æ—¶ä½¿ç”¨ datadogRum åŒ…å†…ç½®çš„ `addFeatureFlagEvaluation` æ–¹æ³•ã€‚

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

const flagEvalResult = fbClient.variation("feature-flag-key", flagsDefaultValues[prop] || '')
datadogRum.addFeatureFlagEvaluation("feature-flag-key", flagEvalResult);
```

å¦‚æœæ‚¨ä¸æƒ³åœ¨æ¯ä¸ªåœ°æ–¹éƒ½å†™ä¸¤è¡Œä»£ç ï¼Œæ‚¨å¯ä»¥å°† `.variation(...)` å’Œ `.addFeatureFlagEvaluation(...)` å°è£…æˆä¸€ä¸ªå‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ [React ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-react/src/featBit/featBitSlice.js) å’Œ [Vue ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-vue/src/featbit.js) é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `Flags Proxy` æ¥æä¾›è·å–åŠŸèƒ½æ ‡å¿—å€¼çš„ç»Ÿä¸€æ¥å£ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å°† addFeatureFlagEvaluation æ·»åŠ åˆ° Flags Proxy ä¸­ï¼Œå¹¶åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

export const createFlagsProxy = () => {
    return new Proxy({}, {
        get(target, prop, _) {
          let returnValue = ''
          if(typeof prop === 'string' && !prop.startsWith('__v_')){
            returnValue = fbClient.variation(prop, flagsDefaultValues[prop] || '');
            datadogRum.addFeatureFlagEvaluation(prop, returnValue);
          }
          return returnValue;
        }
    })
}
```

è¿™æ ·ï¼Œå½“æ‚¨åœ¨ä»£ç ä¸­è°ƒç”¨åŠŸèƒ½æ ‡å¿—æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å‘é€åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®åˆ° DataDogï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```javascript
// Vue ç¤ºä¾‹ï¼Œä½¿ç”¨ Piniaï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿä¿è¯äº†åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
<DinoGameCore v-if="featBitStore.flags['game-runner'] == true"
              :difficulty="featBitStore.flags['difficulty-mode']" />

// React ç¤ºä¾‹ï¼Œä½¿ç”¨ Reduxï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿä¿è¯äº†åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
featureFlags["game-runner"] == true ? 
  <DinoGameCore difficulty={featureFlags["difficulty-mode"]} /> : <>

```


<Callout type="info">
**æ³¨æ„**ï¼šä¸Šè¿°æ•™ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ”¶é›†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®ã€‚å¯¹äº iOS å’Œ Android ç­‰å…¶ä»–å¹³å°ï¼Œè¯·å‚è€ƒ [DataDog æ–‡æ¡£](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=ios#custom-feature-flag-management)ã€‚
</Callout>


### åœ¨ RUM å’Œ APM ä¸­åˆ†ææ‚¨çš„åŠŸèƒ½æ ‡å¿—æ€§èƒ½


é›†æˆäº† FeatBit å’Œ DataDog åï¼Œæ‚¨å¯ä»¥åœ¨ RUM ä¸­[åˆ†æåŠŸèƒ½æ ‡å¿—çš„æ€§èƒ½](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DataDog çš„ RUM ä»ªè¡¨æ¿è¿‡æ»¤ **ä¼šè¯**ã€**è§†å›¾** å’Œ **é”™è¯¯**ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°åœ¨è¯„ä¼° FeatBit çš„è§†å›¾ä¸­æŒ‡å®šæ—¶é—´èŒƒå›´å†…å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](../integrations/assets/datadog/filter-errors-with-feature-flag-in-rum.webp)

è¦æŸ¥çœ‹å’Œåˆ†ææ‚¨çš„åŠŸèƒ½æ ‡å¿—ï¼Œè¯·å‚è€ƒ [DataDog åŠŸèƒ½æ ‡å¿—è·Ÿè¸ªæ•™ç¨‹](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/#view-your-feature-flags)ã€‚

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ [DataDog APM](https://www.datadoghq.com/product/apm/)ï¼ŒDataDog æä¾›äº†ä¸€ç§æ–¹æ³•å°†å‰ç«¯åŠŸèƒ½æ ‡å¿—æ•°æ®ä¸è·Ÿè¸ªè¿æ¥èµ·æ¥ã€‚è¯·å‚è§ [è¿æ¥ RUM å’Œ Traces](https://docs.datadoghq.com/real_user_monitoring/connect_rum_and_traces/?tab=browserrum)ã€‚è¿™æ ·æ‚¨å°±å¯ä»¥åŸºäºå‰ç«¯å’Œåç«¯é”™è¯¯è®¾ç½®è­¦æŠ¥ã€‚

## ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ

Datadog é›†æˆå…è®¸æ‚¨è®¾ç½® [Datadog äº‹ä»¶](https://docs.datadoghq.com/api) æ¥æ¥æ”¶æ¥è‡ª FeatBit çš„ä»»ä½•æ´»åŠ¨ã€‚å½“å‘ç”Ÿå˜åŒ–ï¼Œå¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°æˆ–å‘ FeatBit æ·»åŠ æ–°è´¦æˆ·æˆå‘˜æ—¶ï¼ŒFeatBit ä¼šå‘ Datadog å‘é€äº‹ä»¶ã€‚ä½¿ç”¨æ­¤é›†æˆæ¥å…³è”å’Œç†è§£ FeatBit ä¸­åŠŸèƒ½æ›´æ”¹å¦‚ä½•å½±å“æ‚¨çš„åº”ç”¨å’ŒåŸºç¡€è®¾æ–½æŒ‡æ ‡ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨æœåŠ¡ APM ä»ªè¡¨æ¿ä¸­å‘ç°çš„åŠŸèƒ½æ ‡å¿—äº‹ä»¶ä¸æ•…éšœæ£€æµ‹ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å…³é—­åŠŸèƒ½æ ‡å¿—åï¼Œä¸­æ–­æ¶ˆå¤±äº†ã€‚

![](../integrations/assets/datadog/dashboard-apm-error-turn-off-events.png)

å®Œæ•´çš„äº‹ä»¶é›†æˆä»åœ¨è¿›è¡Œä¸­ã€‚ä½†æ‚¨ç›®å‰å¯ä»¥ç¼–å†™è‡ªå·±çš„ç¨‹åºæ¥ç›‘æ§æˆ‘ä»¬çš„ MongoDB `AuditLogs` é›†åˆä¸­çš„äº‹ä»¶å˜åŒ–ã€‚è¿™é‡Œæ˜¯å¦‚ä½•åœ¨ [.NET ä¸­ç›‘æ§é›†åˆå˜åŒ–çš„å®˜æ–¹æ•™ç¨‹](https://mongodb.github.io/mongo-csharp-driver/2.7/reference/driver/change_streams/)ã€‚

![](../integrations/assets/datadog/mongodb-auditlog-collection.png)

ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨ [DataDog äº‹ä»¶ API](https://docs.datadoghq.com/api/latest/events/#post-an-event) å°†æ´»åŠ¨å‘é€åˆ° DataDogã€‚

<Callout type="info" emoji='ğŸ’¡'>
å¦‚æœæ‚¨å¸Œæœ›æˆ‘ä»¬åŠ å¿«æ­¤å®ç°çš„åŠŸèƒ½å¼€å‘ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ã€‚
</Callout>


## ä½¿ç”¨ Datadog çš„æ ‡å¿—è§¦å‘å™¨

[DataDog çš„ Webhook](https://docs.datadoghq.com/integrations/webhooks/) å…è®¸æ‚¨åœ¨æŒ‡æ ‡è­¦æŠ¥è§¦å‘æ—¶é€šçŸ¥æ‚¨çš„æœåŠ¡ã€‚åœ¨ Webhook é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ç›´æ¥è°ƒç”¨ [FeatBit æ ‡å¿—è§¦å‘å™¨](../feature-flags/feature-workflow/flag-triggers) æ¥åˆ‡æ¢åŠŸèƒ½æ ‡å¿—çš„å¼€/å…³ï¼Œæˆ–è°ƒç”¨ [FeatBit REST API](../api-docs/using-featbit-rest-api) å¯¹ç‰¹å®šç”¨æˆ·ç¾¤ä½“è¿›è¡Œå‘å¸ƒ/å›æ»šã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é…ç½® Webhook æ¥è°ƒç”¨æ ‡å¿—è§¦å‘å™¨çš„æ­¥éª¤ï¼š

1. é¦–å…ˆï¼Œåœ¨åŠŸèƒ½æ ‡å¿—ä¸­åˆ›å»ºä¸€ä¸ªæ ‡å¿—è§¦å‘å™¨ã€‚å‚è§ [å·¥ä½œæµ/æ ‡å¿—è§¦å‘å™¨](/feature-flags/feature-workflow/flag-triggers)ã€‚

![](../integrations/assets/datadog/flag-trigger.png)

2. åœ¨ DataDog é›†æˆä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Webhookï¼Œå¹¶åœ¨æ–°çš„ Webhook ä¸­å¤åˆ¶æ ‡å¿—è§¦å‘å™¨çš„ URLã€‚

![](../integrations/assets/datadog/create-webhook.png)

3. è½¬åˆ°ç›‘æ§é¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æœç´¢æŸ¥è¯¢å’Œæ¡ä»¶çš„æŒ‡æ ‡ã€‚ç„¶ååœ¨è­¦æŠ¥æ–‡æœ¬ä¸­æ·»åŠ  `@webhook-Webhookåç§°`ã€‚å½“æŒ‡æ ‡ä½äºæ¡ä»¶ä¸­è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°†è§¦å‘ Webhookã€‚

![](../integrations/assets/datadog/monitor-notify-team.png)

4. è§¦å‘ Webhook åï¼ŒåŠŸèƒ½æ ‡å¿—ä¼šè‡ªåŠ¨åˆ‡æ¢å¼€/å…³ã€‚

## å°†åŠŸèƒ½æ ‡å¿—è§è§£å¯¼å‡ºåˆ° DataDog APM

Datadog æä¾›äº†å„ç§å·¥å…·å’ŒåŠŸèƒ½ï¼Œç”¨äºç›‘æ§åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨ **æŒ‡æ ‡** å¿«é€Ÿäº†è§£ç¯å¢ƒçš„å¥åº·çŠ¶å†µã€‚ä¾‹å¦‚ï¼Œå¯è§†åŒ–ç”¨æˆ·åŠ è½½æ‚¨çš„ç½‘ç«™çš„é€Ÿåº¦ï¼Œæˆ–æ‚¨çš„æœåŠ¡å™¨çš„å¹³å‡å†…å­˜æ¶ˆè€—ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **æ—¥å¿—** å’Œ **è·Ÿè¸ª** è¿›ä¸€æ­¥æ’æŸ¥é—®é¢˜ã€‚

é™¤äº†ä¸Šè¿°å‘ APM å‘é€æ´»åŠ¨äº‹ä»¶ï¼ˆå‚è§ [ä½¿ç”¨ Datadog äº‹ä»¶é›†æˆ](#ä½¿ç”¨-datadog-äº‹ä»¶é›†æˆ)ï¼‰ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨ Pro ç‰ˆæœ¬ä¸­çš„ **ClickHouse** æˆ–åœ¨æ ‡å‡†ç‰ˆä¸­çš„ **MongoDB**ï¼Œå°† FeatBit çš„åŠŸèƒ½æ ‡å¿—è§è§£æ•°æ®ï¼ˆåŒ…æ‹¬å‰ç«¯å’Œåç«¯åŠŸèƒ½æ ‡å¿—ä½¿ç”¨æ•°æ®ï¼‰å’Œè‡ªå®šä¹‰äº‹ä»¶æ•°æ®å¯¼å‡ºåˆ° DataDogï¼Œä»è€Œä¸ DataDog APM å’Œ Metrics æ·±åº¦é›†æˆã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹©æŒ‡æ ‡æ¥æ¦‚è§ˆæ ‡å¿—ä½¿ç”¨æƒ…å†µï¼ˆè®¡æ•°ã€é«˜å±‚å½±å“ï¼‰å’Œè·Ÿè¸ªæ¥æ·±å…¥äº†è§£æ ‡å¿—å¦‚ä½•å½±å“å•ä¸ªè¯·æ±‚ã€‚åŒæ—¶ä½¿ç”¨æŒ‡æ ‡å’Œè·Ÿè¸ªå¯ä»¥æä¾›åŠŸèƒ½æ ‡å¿—è¡Œä¸ºå’Œåº”ç”¨ç¨‹åºæ€§èƒ½çš„å…¨é¢è§†å›¾ã€‚

**å¦‚æœæ‚¨å¯¹æ­¤å®ç°æœ‰ä»»ä½•æƒ³æ³•ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¶åˆ°æ‚¨çš„åé¦ˆ**ã€‚