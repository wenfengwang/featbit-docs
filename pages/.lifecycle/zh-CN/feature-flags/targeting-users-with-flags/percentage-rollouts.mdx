import { Callout } from 'nextra/components'

# 百分比扩展

## 概述 <a href="#overview" id="overview"></a>

本主题介绍如何使用百分比扩展逐步发布新功能给用户。

百分比扩展允许您通过逐步向用户发布功能来管理部署风险。您可以将功能逐步推出给一小部分随机用户，并在您对功能的运行符合预期的信心增加时，逐渐提高百分比。

## 创建百分比扩展 <a href="#creating-percentage-rollouts" id="creating-percentage-rollouts"></a>

您可以在标志的目标规则或标志的默认规则中创建百分比扩展。

下面是默认规则中的百分比扩展的图像：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/001.png)

在此示例中，将有25％的用户接收到新功能。如果新功能按预期工作，您可以逐步增加接收新功能的用户百分比，直到最终达到100％。

如果您想将一个变体推广给很少一部分用户，您可以将一个变体分配给小于1％的用户。您可以使用三位小数，例如0.125％。

## 理解百分比扩展逻辑 <a href="#understanding-percentage-rollout-logic" id="understanding-percentage-rollout-logic"></a>

当您设置百分比扩展时，每个用户基于其用户密钥接收特定的变体。

百分比扩展逻辑根据用户密钥生成哈希。SDK使用此哈希为该用户生成一个百分比值。该值与为百分比扩展值设置的值进行比较，确定用户接收哪个变体。哈希具有从0到2147483648的分区。当您分配标志变体时，哈希将为每个分区的用户分配从0到2147483648的值。例如，当您将50％分配给变体A时，FeatBit将变体A分配给1到1073741824的哈希分区。

百分比扩展的常见用例是逐步增加标志所针对的用户百分比，直到100％的用户收到标志的一个变体。当您更改用户分配到标志变体的百分比时，这些用户会根据其分区在0到2147483648哈希列表中的位置重新分配不同的标志变体。例如，如果您将接收变体A的用户的百分比从50％更改为70％，那么1073741825到1503238554的分区将会被添加到已经接收变体A的分区集合中。

### 使用高级扩展 <a href="#using-advanced-rollouts" id="using-advanced-rollouts"></a>

您可以根据**按分配**菜单中的任何用户属性为用户分配变体。

例如，您可以将一个功能推广给25％的用户，但是用户将根据其`team-region`属性的值而不是随机分配给变体。这样可以确保FeatBit将具有匹配的属性-值对的所有用户分配到同一个变体。

下面是高级扩展的图像：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/002.webp)