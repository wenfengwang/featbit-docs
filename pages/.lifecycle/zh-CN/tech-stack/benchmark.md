# 基准测试

FeatBit的目标之一是创建一个可伸缩且快速的实时特性标志管理服务。对于这一点，我们关注处理并发用户的能力，这主要取决于评估服务器服务的性能。本文档在隔离的最小环境中提供了评估服务器的性能报告。

## 测试目标

我们需要确定评估服务器是否符合以下性能要求。

评估服务器需要能够处理每秒1000个新连接，并以响应时间和错误率的行业标准提供服务。 99百分位数（P99）响应时间应小于200毫秒，可接受的错误率应小于1％。以此标准，我们将确保评估服务器的最大容量，并提供高可靠性的服务。

本文档未涵盖FeatBit可以在给定时间内承载的最大用户连接数，因为我们观察到当没有数据同步发生时，CPU和内存的使用率很低。将在以后的报告中介绍将更改推送给已连接用户的能力。

## 一般测试条件

以下测试条件最适合模拟实际使用情况。

* 每秒建立的新连接数量（包括数据同步）
* 平均P99响应时间 **(1)**
* 用户操作：在建立连接后发出数据同步请求

**(1)** 响应时间：从发送数据同步请求到接收响应所经过的时间。

## 环境

我们选择了常见的AWS EC2服务来托管评估服务器服务。实例类型为**t2.micro，具有1个vCPU和1 GiB RAM**，符合免费配额条件。

我们使用EC2实例执行我们的测试，这可以将网络对结果的影响降到最低。

## 执行的测试

**测试持续时间**：180秒

**负载类型**：从每秒0到1000、1100、1200个新连接的逐步增加

**测试次数**：每秒1000、1100和1200的每个用例各进行10次测试

## 测试结果

执行的测试表明，评估服务器只能在有限的负载下保持所需的服务质量。当达到每秒1200个新连接时，出现了一些错误。

**响应时间**

<table><thead><tr><th width="378">Number of new connections per second</th><th width="100">Avg (ms)</th><th width="100">P95 (ms)</th><th>P99 (ms)</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>

**CPU利用率峰值 %**

| 每秒新连接数 | 启动阶段 | 稳定阶段 |
| ------------ | -------- | -------- |
| 1000         | 82       | 26       |
| 1100         | 88       | 29       |
| 1200         | 91       | 31       |

**内存利用率峰值 %**

| 每秒新连接数 | 启动阶段 | 稳定阶段 |
| ------------ | -------- | -------- |
| 1000         | 55       | 38       |
| 1100         | 58       | 42       |
| 1200         | 61       | 45       |

## 结论

在最小硬件设置下：**AWS EC2 t2.micro（1个vCPU + 1 G RAM）**，评估服务器能够为每秒1100个新连接提供可靠的服务，每个给定时间内所持有的最大连接数达到22000个（这不是限制）。

测试期间测得的Web服务器资源利用率显示硬件的瓶颈是CPU，这是可以理解的，因为CPU在数据同步阶段期间被大量用于评估特性标志。通过使用具有更多vCPU的实例（或计算优化的实例），我们肯定可以增加每秒最大新连接数的容量。

我们相信报告的性能对于中小企业来说已经足够了，而成本可以忽略不计（符合免费配额条件）。当业务增长时，可以通过水平扩展服务来轻松地扩大容量。

## 用于测试的数据集

在上述测试中，我们使用了5个特性标志和2个分段。测试数据详见以下链接。

[特性标志测试示例文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[分段测试示例文件](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)