import { Callout } from 'nextra/components'

# DataDog

FeatBit æä¾›ä»¥ä¸‹é›†æˆ DataDog çš„æ–¹æ³•ï¼š

1. ä½¿ç”¨ DataDog RUM é›†æˆï¼Œå°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§ [ä½¿ç”¨ Datadog RUM é›†æˆ](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)ã€‚
2. ä½¿ç”¨ DataDog äº‹ä»¶é›†æˆï¼Œæ¥æ”¶æ¥è‡ª FeatBit çš„æ´»åŠ¨ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§ [ä½¿ç”¨ DataDog äº‹ä»¶é›†æˆ](https://docs.datadoghq.com/api/?lang=bash#events)ã€‚
3. ä½¿ç”¨æ ‡å¿—è§¦å‘å™¨ï¼Œå½“ DataDog æŒ‡æ ‡ä½äºä¸€å®šé˜ˆå€¼æ—¶å›æ»šåŠŸèƒ½æ ‡å¿—ã€‚
4. å¯¼å‡º Feature Flags Insights åˆ° DataDog APMã€‚

## ä½¿ç”¨ DataDog RUM é›†æˆ

[åŠŸèƒ½æ ‡å¿—è·Ÿè¸ª](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/) é€šè¿‡ç¡®å®šå“ªäº›ç”¨æˆ·æ˜¾ç¤ºäº†ç‰¹å®šåŠŸèƒ½ä»¥åŠå¼•å…¥çš„ä»»ä½•æ›´æ”¹æ˜¯å¦å½±å“ç”¨æˆ·ä½“éªŒæˆ–æ€§èƒ½ï¼Œä¸ºæ‚¨æä¾›äº†å¯¹ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ç›‘æ§çš„æ›´æ·±å…¥çš„å¯è§æ€§ã€‚

### è®¾ç½®åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†

è¦å¼€å§‹ä½¿ç”¨ï¼Œæ‚¨éœ€è¦[è®¾ç½® DataDog åŠŸèƒ½æ ‡å¿—æ•°æ®æ”¶é›†](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection)ã€‚å¯¹äº JavaScript / TypeScript é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆå§‹åŒ– RUM SDKï¼Œå¹¶ä½¿ç”¨ `["feature_flags"]` é…ç½® `enableExperimentalFeatures` åˆå§‹åŒ–å‚æ•°ã€‚è¿™å°†å¯ç”¨åŠŸèƒ½æ ‡å¿—è·Ÿè¸ªåŠŸèƒ½ï¼Œå¹¶å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogã€‚

```javascript
datadogRum.init({
  applicationId: "sample-application-id",
  clientToken: "sample-client-token",
  site: "datadoghq.com",
  service: "demo-app",
  env: "dev",
  version: "1.0.0",
  sessionSampleRate: 100,
  sessionReplaySampleRate: 100,
  trackUserInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  defaultPrivacyLevel: "mask-user-input",
  // This enables the beta feature flag tracking
  enableExperimentalFeatures: ["feature_flags"]
});

datadogRum.startSessionReplayRecording();
```

ç„¶åï¼Œåœ¨è¯„ä¼° `FeatBit` åŠŸèƒ½æ ‡å¿—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®åœ¨ `datadogRum` åŒ…ä¸­çš„ `addFeatureFlagEvaluation` æ–¹æ³•ã€‚

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

const flagEvalResult = fbClient.variation("feature-flag-key", flagsDefaultValues[prop] || '')
datadogRum.addFeatureFlagEvaluation("feature-flag-key", flagEvalResult);
```

å¦‚æœæ‚¨ä¸æƒ³åœ¨æ¯ä¸ªåœ°æ–¹éƒ½å†™ä¸¤è¡Œä»£ç ï¼Œæ‚¨å¯ä»¥å°† `.variation(...)` å’Œ `.addFeatureFlagEvaluation(...)` å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ [React ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-react/src/featBit/featBitSlice.js) å’Œ [Vue ç¤ºä¾‹](https://github.com/featbit/featbit-samples/blob/main/samples/dino-game/interactive-demo-vue/src/featbit.js) é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `Flags Proxy`ï¼Œä»¥æä¾›ç»Ÿä¸€çš„æ¥å£æ¥è·å–åŠŸèƒ½æ ‡å¿—å€¼ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å°† `addFeatureFlagEvaluation` æ·»åŠ åˆ° Flags Proxy ä¸­ï¼Œå¹¶åƒä¸‹é¢è¿™æ ·ä½¿ç”¨å®ƒï¼š

```javascript
import { datadogRum } from "@datadog/browser-rum";
import fbClient from "featbit-js-client-sdk";

export const createFlagsProxy = () => {
    return new Proxy({}, {
        get(target, prop, _) {
          let returnValue = ''
          if(typeof prop === 'string' && !prop.startsWith('__v_')){
            returnValue = fbClient.variation(prop, flagsDefaultValues[prop] || '');
            datadogRum.addFeatureFlagEvaluation(prop, returnValue);
          }
          return returnValue;
        }
    })
}
```

å› æ­¤ï¼Œå½“æ‚¨åœ¨ä»£ç ä¸­è°ƒç”¨ä¸€ä¸ªåŠŸèƒ½æ ‡å¿—æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨å°†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®å‘é€åˆ° DataDogï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š

```javascript
// Vue ç¤ºä¾‹ï¼ˆä½¿ç”¨ Piniaï¼‰ï¼Œä¸‹é¢çš„ä»£ç è¿˜ç¡®ä¿äº†åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
<DinoGameCore v-if="featBitStore.flags['game-runner']== true"
              :difficulty="featBitStore.flags['difficulty-mode']" />

// React ç¤ºä¾‹ï¼ˆä½¿ç”¨ Reduxï¼‰ï¼Œä¸‹é¢çš„ä»£ç è¿˜ç¡®ä¿äº†åŠŸèƒ½æ ‡å¿—å€¼çš„å®æ—¶æ›´æ–°
featureFlags["game-runner"] == true ? 
  <DinoGameCore difficulty={featureFlags["difficulty-mode"]} /> : <>

```


<Callout type="info">
**æ³¨æ„**ï¼šä¸Šé¢çš„æ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ”¶é›†åŠŸèƒ½æ ‡å¿—è¯„ä¼°æ•°æ®ã€‚å¯¹äº iOS å’Œ Android ç­‰å…¶ä»–å¹³å°ï¼Œè¯·å‚é˜…[DataDog æ–‡æ¡£](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=ios#custom-feature-flag-management)ã€‚
</Callout>


### åœ¨ RUM å’Œ APM ä¸­åˆ†æåŠŸèƒ½æ ‡å¿—æ€§èƒ½


ä¸€æ—¦æ‚¨å°† FeatBit ä¸ DataDog é›†æˆï¼Œæ‚¨å¯ä»¥åœ¨ RUM ä¸­ [åˆ†æåŠŸèƒ½æ ‡å¿—çš„æ€§èƒ½](https://docs.datadoghq.com/real_user_monitoring/guide/setup-feature-flag-data-collection/?tab=browser#analyze-your-feature-flag-performance-in-rum)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DataDog çš„ RUM ä»ªè¡¨æ¿å¯¹æ‚¨çš„**ä¼šè¯**ã€**è§†å›¾**å’Œ**é”™è¯¯**è¿›è¡Œç­›é€‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŸ¥æ‰¾åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…å‘ç”Ÿåœ¨è¯„ä¼° FeatBit çš„è§†å›¾ä¸­çš„æ‰€æœ‰é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](../integrations/assets/datadog/filter-errors-with-feature-flag-in-rum.webp)

è¦æŸ¥çœ‹å’Œåˆ†æåŠŸèƒ½æ ‡å¿—ï¼Œè¯·å‚é˜…[DataDog åŠŸèƒ½æ ‡å¿—è¿½è¸ªæ•™ç¨‹](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/#view-your-feature-flags)ã€‚

å¦‚æœæ‚¨ä½¿ç”¨[DataDog APM](https://www.datadoghq.com/product/apm/)ï¼ŒDataDog æä¾›äº†ä¸€ç§æ–¹æ³•å°†å‰ç«¯åŠŸèƒ½æ ‡å¿—æ•°æ®è¿æ¥åˆ°è·Ÿè¸ªä¸­ã€‚è¯·å‚é˜…[Connect Rum and Traces](https://docs.datadoghq.com/real_user_monitoring/connect_rum_and_traces/?tab=browserrum)ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥æ ¹æ®å‰ç«¯å’Œåç«¯é”™è¯¯æ¥è®¾ç½®è­¦æŠ¥ã€‚

## ä½¿ç”¨ DataDog äº‹ä»¶é›†æˆ

ä½¿ç”¨ DataDog äº‹ä»¶é›†æˆï¼Œæ‚¨å¯ä»¥è®¾ç½® [Datadog äº‹ä»¶](https://docs.datadoghq.com/api) æ¥æ¥æ”¶æ¥è‡ª FeatBit çš„ä»»ä½•æ´»åŠ¨ã€‚å½“å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾‹å¦‚åŠŸèƒ½æ ‡å¿—æ›´æ–°æˆ–å°†æ–°çš„è´¦æˆ·æˆå‘˜æ·»åŠ åˆ° FeatBit ä¸­ï¼ŒFeatBit ä¼šå‘ DataDog å‘é€ä¸€ä¸ªäº‹ä»¶ã€‚ä½¿ç”¨æ­¤é›†æˆå°†æœ‰åŠ©äºæ‚¨äº†è§£åŠŸèƒ½åœ¨ FeatBit ä¸­çš„æ›´æ”¹å¦‚ä½•å½±å“åº”ç”¨ç¨‹åºå’ŒåŸºç¡€æ¶æ„æŒ‡æ ‡ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨æœåŠ¡ APM ä»ªè¡¨æ¿ä¸­å‘ç°çš„åŠŸèƒ½æ ‡å¿—äº‹ä»¶ä¸æ•…éšœæ£€æµ‹ä¹‹é—´çš„å…³è”ã€‚åœ¨å…³é—­åŠŸèƒ½æ ‡å¿—åï¼Œæ•…éšœæ¶ˆå¤±äº†ã€‚

![](../integrations/assets/datadog/dashboard-apm-error-turn-off-events.png)

å®Œæ•´çš„äº‹ä»¶é›†æˆè¿˜åœ¨è¿›è¡Œä¸­ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ç¼–å†™è‡ªå·±çš„ç¨‹åºæ¥ç›‘æ§æˆ‘ä»¬çš„ MongoDB `AuditLogs` é›†åˆä¸­çš„äº‹ä»¶å˜åŒ–ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•[åœ¨ .NET ä¸­ç›‘æµ‹é›†åˆä¸­çš„å˜åŒ–](https://mongodb.github.io/mongo-csharp-driver/2.7/reference/driver/change_streams/)çš„å®˜æ–¹æ•™ç¨‹ã€‚

![](../integrations/assets/datadog/mongodb-auditlog-collection.png)

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[DataDog Events API](https://docs.datadoghq.com/api/latest/events/#post-an-event)å°†æ´»åŠ¨å‘é€åˆ° DataDogã€‚

<Callout type="info" emoji='ğŸ’¡'>
å¦‚æœæ‚¨å¸Œæœ›æˆ‘ä»¬åŠ é€Ÿæ­¤å®ç°çš„åŠŸèƒ½å¼€å‘ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ã€‚
</Callout>


## ä½¿ç”¨ DataDog çš„æ ‡å¿—è§¦å‘å™¨

[DataDog çš„ Webhook](https://docs.datadoghq.com/integrations/webhooks/) å…è®¸æ‚¨åœ¨è§¦å‘åº¦é‡è­¦æŠ¥æ—¶é€šçŸ¥æ‚¨çš„æœåŠ¡ã€‚åœ¨ Webhook é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ç›´æ¥è°ƒç”¨ [FeatBit æ ‡å¿—è§¦å‘å™¨](/feature-flags/feature-workflow/flag-triggers) æ¥åˆ‡æ¢åŠŸèƒ½æ ‡å¿—çš„å¼€/å…³ï¼Œæˆ–è°ƒç”¨ [FeatBit REST API](/api-docs/using-featbit-rest-api) å°†ç‰¹å®šç»„çš„ç”¨æˆ·è¿›è¡Œéƒ¨ç½²/å›æ»šã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é…ç½® Webhook æ¥è°ƒç”¨ Flag è§¦å‘å™¨ï¼š

1. æ‚¨éœ€è¦é¦–å…ˆåœ¨åŠŸèƒ½æ ‡å¿—ä¸­åˆ›å»ºä¸€ä¸ªæ ‡å¿—è§¦å‘å™¨ã€‚è¯·å‚é˜… [Workflow/Flag Triggers](/feature-flags/feature-workflow/flag-triggers)ã€‚

![](../integrations/assets/datadog/flag-trigger.png)

2. åœ¨ DataDog é›†æˆä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ WebHook å¹¶å¤åˆ¶æ–° WebHook ä¸­çš„ Flag Trigger URLã€‚

![](../integrations/assets/datadog/create-webhook.png)

3. è½¬åˆ°ç›‘è§†å™¨é¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªå…·æœ‰æœç´¢æŸ¥è¯¢å’Œæ¡ä»¶çš„åº¦é‡æ ‡å‡†ã€‚ç„¶ååœ¨è­¦æŠ¥çš„æ–‡æœ¬ä¸­æ·»åŠ  `@webhook-name_of_the_webhook`ã€‚å½“åº¦é‡æ ‡å‡†ä½äºæ¡ä»¶ä¸­è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°†è§¦å‘WebHookã€‚

![](../integrations/assets/datadog/monitor-notify-team.png)

4. WebHook è¢«è§¦å‘åï¼ŒåŠŸèƒ½æ ‡å¿—ä¼šè‡ªåŠ¨åˆ‡æ¢å¼€/å…³ã€‚

## å¯¼å‡º Feature Flags Insights åˆ° DataDog APM

Datadog æä¾›äº†å„ç§å·¥å…·å’ŒåŠŸèƒ½æ¥ç›‘æ§åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨ **Metrics** æ¥ä¸€ç›®äº†ç„¶åœ°è¯„ä¼°ç¯å¢ƒçš„å¥åº·çŠ¶å†µã€‚ä¾‹å¦‚ï¼Œå¯è§†åŒ–ç”¨æˆ·åŠ è½½ç½‘ç«™çš„é€Ÿåº¦æˆ–æ‚¨æœåŠ¡å™¨çš„å¹³å‡å†…å­˜æ¶ˆè€—ã€‚ä¸€æ—¦æ‚¨å‘ç°é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **logs** å’Œ **tracing** è¿›è¡Œè¿›ä¸€æ­¥çš„æ•…éšœæ’é™¤ã€‚

é™¤äº†åƒä¸Šé¢æåˆ°çš„é‚£æ ·å°†æ´»åŠ¨äº‹ä»¶å‘é€åˆ° APMï¼ˆ[ä½¿ç”¨ DataDog çš„äº‹ä»¶é›†æˆ](#ä½¿ç”¨-dataog-çš„-events-é›†æˆ)ï¼‰ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡**ClickHouse**ï¼ˆåœ¨ä¸“ä¸šç‰ˆä¸­ï¼‰æˆ–**MongoDB**ï¼ˆåœ¨æ ‡å‡†ç‰ˆä¸­ï¼‰å°† FeatBit çš„åŠŸèƒ½æ ‡å¿—æ´å¯Ÿæ•°æ®ï¼ˆä¸¤è€…éƒ½é€‚ç”¨äºå‰ç«¯å’Œåç«¯åŠŸèƒ½æ ‡å¿—ä½¿ç”¨æ•°æ®ï¼‰ä»¥åŠè‡ªå®šä¹‰äº‹ä»¶æ•°æ®å¯¼å‡ºåˆ° DataDogï¼Œä¸ DataDog APM å’Œ Metrics æ·±åº¦é›†æˆã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨ Metrics æ¥æ¦‚è§ˆåŠŸèƒ½æ ‡å¿—çš„ä½¿ç”¨æƒ…å†µï¼ˆè®¡æ•°ï¼Œé«˜çº§å½±å“ï¼‰ï¼Œå¹¶ä½¿ç”¨ Traces æ¥æ·±å…¥äº†è§£åŠŸèƒ½æ ‡å¿—å¦‚ä½•å½±å“å•ä¸ªè¯·æ±‚ã€‚åŒæ—¶ä½¿ç”¨æŒ‡æ ‡å’Œè¿½è¸ªå¯ä»¥æä¾›å…¨é¢çš„åŠŸèƒ½æ ‡å¿—è¡Œä¸ºå’Œåº”ç”¨ç¨‹åºæ€§èƒ½è§†å›¾ã€‚

**æˆ‘ä»¬å¸Œæœ›äº†è§£æ‚¨å¯¹æ­¤å®ç°çš„ä»»ä½•æƒ³æ³•**ã€‚