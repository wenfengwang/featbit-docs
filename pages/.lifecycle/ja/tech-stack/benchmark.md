# ベンチマーク

FeatBitの目標の1つは、スケーラブルで高速なリアルタイム機能フラグ管理サービスを作成することです。この点で、私たちは同時ユーザーを処理する能力に焦点を当てていますが、これは主にEvaluation Serverサービスのパフォーマンスに依存します。このドキュメントでは、分離された最小環境でのEvaluation Serverのパフォーマンスレポートを提供します。

## テストの目的

Evaluation Serverが以下で指定されているパフォーマンス要件を満たしているかどうかを確認する必要があります。

Evaluation Serverは、毎秒1000の新規接続を処理でき、応答時間とエラー率の点で業界標準レベルのサービスを提供できる必要があります。99パーセンタイル（P99）応答時間は200ミリ秒未満である必要があり、許容可能なエラー率は1%未満です。この基準により、信頼性の高いサービスを提供しながら、Evaluation Serverの最大容量を保証します。

FeatBitが一定時間保持できる最大ユーザー接続数は、データ同期が行われていない場合にCPUとメモリの使用率が低いことが確認されたため、このドキュメントではカバーされていません。接続されているユーザーに変更をプッシュする能力については、将来のレポートでカバーされる予定です。

## 一般的なテスト条件

実際の使用状況をシミュレートするには、以下のテスト条件が最も適しています。

* 秒間に確立された新規接続の数（データ同期を含む）
* 平均P99応答時間 **(1)**
* ユーザーアクション: 接続が確立された後にデータ同期リクエストを行う

**(1)** 応答時間: データ同期リクエストが送信される前と、応答が受信された後の経過時間。

## 環境

Evaluation Serverサービスをホストするために、一般的に利用可能なAWS EC2サービスを選択しました。インスタンスタイプは **t2.microで、1 vCPUと1 GiBのRAM** を備えており、無料利用枠の対象です。

EC2インスタンスを使用してテストを実行し、結果に対するネットワークの影響を最小限に抑えました。

## 実施されたテスト

**テスト期間**: 180秒

**負荷タイプ**: 0から毎秒1000、1100、1200の新規接続数への増加

**テスト数**: 毎秒1000、1100、1200の各ユースケースについて10回

## テスト結果

実施されたテストは、Evaluation Serverが制限された負荷でのみ所望のサービス品質を維持することを示しました。毎秒1100の新規接続までは問題なく、1200/sに達するとエラーが観測されました。

**応答時間**

<table><thead><tr><th width="378">毎秒の新規接続数</th><th width="100">平均(ms)</th><th width="100">P95(ms)</th><th>P99(ms)</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>

**ピークCPU使用率 %**

| 毎秒の新規接続数 | ランプアップステージ | 安定ステージ |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 82            | 26           |
| 1100                                 | 88            | 29           |
| 1200                                 | 91            | 31           |

**ピークメモリ使用率 %**

| 毎秒の新規接続数 | ランプアップステージ | 安定ステージ |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 55            | 38           |
| 1100                                 | 58            | 42           |
| 1200                                 | 61            | 45           |

## 結論

最小ハードウェア設定：**AWS EC2 t2.micro（1 vCPU + 1 GiB RAM）**では、Evaluation Serverは毎秒1100の新規接続まで信頼性の高いサービスを提供でき、特定の時間に保持される最大接続数は22000に達します（これは限界ではありません）。

テスト中に測定されたウェブサーバーのリソース使用率は、ハードウェアのボトルネックがCPUであることを示しており、データ同期ステージで機能フラグを評価する際にCPUが集中的に使用されるため、これは理解できます。より多くのvCPU（またはコンピュート最適化インスタンス）を備えたインスタンスを使用することで、毎秒の最大新規接続数の容量を確実に増やすことができます。

報告されたパフォーマンスは、ほとんどの小規模ビジネスにとって十分であり、コストはごくわずか（無料利用枠の対象）です。ビジネスの成長に合わせてサービスを水平方向にスケーリングすることで、容量を簡単に増やすことができます。&#x20;

## テストに使用したデータセット

上記のテストでは、5つのfeature flagsと2つのsegmentsを使用しました。テストデータは以下に添付されています。

[Feature flags test sample file](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[Segments test sample file](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)

