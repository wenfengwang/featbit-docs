# ベンチマーク

FeatBitの目標の一つは、スケーラブルで高速なリアルタイムのフィーチャーフラグ管理サービスを作成することです。この点において、我々は同時接続ユーザーの処理能力に焦点を当て、これは主に評価サーバーサービスのパフォーマンスに依存します。このドキュメントでは、評価サーバーのパフォーマンスレポートを、孤立した最小環境で提供しています。

## テスト目的

以下のパフォーマンス要件を満たしているかどうかを調べる必要があります。

評価サーバーは、応答時間とエラーレートの面で業界標準レベルのサービスを提供しながら、秒あたり1000件の新規接続を処理できる必要があります。99パーセンタイル(P99)の応答時間は200ミリ秒未満である必要があり、許容エラーレートは1％未満です。これにより、信頼性の高いサービスを提供しつつ、評価サーバーの最大容量を確保します。

特定の時間におけるFeatBitが保持できるユーザー接続数の最大値については、このドキュメントではカバーしていません。データ同期が行われていない場合、CPU使用率とメモリ使用率が低いことが観察されました。接続されたユーザーに変更をプッシュする能力については、将来のレポートでカバーされます。

## 一般的なテスト条件

以下のテスト条件が、実際の使用法をシミュレートするために最も適しています。

- 秒ごとに確立される新しい接続数（データ同期を含む）
- 平均P99応答時間 **(1)**
- ユーザーアクション：接続が確立された後にデータ同期リクエストを行う

**(1)** 応答時間：データ同期リクエストが送信されてから応答が受信されるまでの経過時間。

## 環境

我々は評価サーバーサービスをホストするために、一般的に利用可能なAWS EC2サービスを選択しました。インスタンスタイプは**t2.microで、1つのvCPUと1 GiB RAM**を持っており、フリーティアに対応しています。

テストを実行するためにEC2インスタンスを使用しましたが、これにより結果に対するネットワークの影響を最小限に抑えることができます。

## 実施されたテスト

**テストの期間**: 180秒

**負荷の種類**: 0から1000、1100、1200件の新規接続を秒ごとに増やしていく

**テストの回数**: それぞれ1000、1100、1200件の接続数について10回ずつ

## テスト結果

実施したテストは、評価サーバーが望ましいサービス品質を保持するのは限られた負荷の場合のみであることを示しています。1200件/秒に到達すると、いくつかのエラーが発生しますが、1100件/秒までは望ましい応答時間とエラーレートが得られます。

**応答時間**

<table><thead><tr><th width="378">秒ごとの新規接続数</th><th width="100">平均 (ms)</th><th width="100">P95 (ms)</th><th>P99 (ms)</th></tr></thead><tbody><tr><td>1000</td><td>5.42</td><td>24.7</td><td>96.70</td></tr><tr><td>1100</td><td>9.98</td><td>55.51</td><td>170.30</td></tr><tr><td>1200</td><td>34.17</td><td>147.91</td><td>254.60</td></tr></tbody></table>

**ピーク時のCPU利用率 %**

| 秒ごとの新規接続数 | ランプアップステージ | 安定ステージ |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 82            | 26           |
| 1100                                 | 88            | 29           |
| 1200                                 | 91            | 31           |

**ピーク時のメモリ利用率 %**

| 秒ごとの新規接続数 | ランプアップステージ | 安定ステージ |
| ------------------------------------ | ------------- | ------------ |
| 1000                                 | 55            | 38           |
| 1100                                 | 58            | 42           |
| 1200                                 | 61            | 45           |

## 結論

最小のハードウェア設定である**AWS EC2 t2.micro（1つのvCPU + 1 G RAM）**を使用すると、評価サーバーは秒あたり1100件までの新規接続に対して信頼性の高いサービスを提供することができます。特定の時間に保持される最大接続数は22,000です（これは限界ではありません）。

テスト中に計測されたWebサーバーのリソース利用状況は、ハードウェアのボトルネックがCPUであることを示しています。これは理解できることです。CPUはデータ同期の段階でフィーチャーフラグの評価に集中的に使用されるためです。より多くのvCPUを持つインスタンス（またはコンピュート最適化されたインスタンス）を使用することにより、秒あたりの新規接続数の容量を確実に増やすことができます。

報告されたパフォーマンスは、小規模ビジネスにとって十分すぎると考えています。コストは無視できるレベルです（フリーティアに対応しています）。ビジネスが成長するにつれて、サービスを水平方向にスケールすることで容量を簡単に増やすことができます。&#x20;

## テストに使用されたデータセット

上記のテストでは、5つのフィーチャーフラグと2つのセグメントを使用しました。テストデータは以下に添付されています。

[フィーチャーフラグのテストサンプルファイル](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/flags.json)

[セグメントのテストサンプルファイル](https://github.com/featbit/featbit-docs/blob/main/pages/tech-stack/assets/segments.json)