import { Callout } from 'nextra/components'

# パーセンテージロールアウト

## 概要 <a href="#overview" id="overview"></a>

このトピックでは、新機能を段階的にユーザーにリリースするためのパーセンテージロールアウトの使用方法について説明します。

パーセンテージロールアウトを利用することで、機能を徐々にユーザーにリリースすることにより、デプロイメントのリスクを管理できます。小さな割合のランダムなユーザーに機能をロールアウトし、その機能が意図した通りに動作していると確信が持てたら、徐々にその割合を増やしていくことができます。

## パーセンテージロールアウトの作成 <a href="#creating-percentage-rollouts" id="creating-percentage-rollouts"></a>

フラグのターゲティングルールまたはフラグのデフォルトルールでパーセンテージロールアウトを作成できます。

以下は、デフォルトルールでのパーセンテージロールアウトの画像です：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/001.png)

この例では、25%のユーザーが新機能を受け取ります。新機能が期待通りに機能する場合、新機能を受け取るユーザーの割合を徐々に増やし、最終的には100%に達することができます。

非常に少数のユーザーにバリエーションをロールアウトしたい場合は、バリエーションに1%未満の割合を割り当てることができます。例えば、0.125%など、小数点以下3桁まで指定できます。

## パーセンテージロールアウトロジックの理解 <a href="#understanding-percentage-rollout-logic" id="understanding-percentage-rollout-logic"></a>

パーセンテージロールアウトを設定すると、各ユーザーはそのユーザーキーに基づいて特定のバリエーションを受け取ります。

パーセンテージロールアウトロジックは、ユーザーキーに基づいてハッシュを生成します。SDKはこのハッシュを使用して、そのユーザーのパーセンテージ値を生成します。この値は、パーセンテージロールアウト値に設定された値と比較され、ユーザーが受け取るバリエーションを決定します。ハッシュは0から2147483648までのパーティションに分けられています。フラグバリエーションを割り当てる際には、ハッシュは0から2147483648までの値を各パーティションのユーザーに順番に割り当てます。例えば、バリエーションAに50%を割り当てた場合、FeatBitはハッシュパーティション1から1073741824までのユーザーにバリエーションAを提供します。

パーセンテージロールアウトの一般的な使用例は、フラグの対象ユーザーの割合を時間が経つにつれて増やし、最終的には100%のユーザーがフラグのバリエーションの1つを受け取るまで増やすことです。フラグバリエーションへのユーザー割り当てのパーセンテージを変更すると、それらのユーザーは0から2147483648のハッシュリスト内のパーティションの位置に基づいて、異なるフラグバリエーションに再割り当てされます。例えば、バリエーションAを受け取るユーザーの割合を50%から70%に変更すると、1073741825から1503238554のパーティションが、既にバリエーションAを受け取っているパーティションセットに追加されます。

### アドバンストロールアウトの使用 <a href="#using-advanced-rollouts" id="using-advanced-rollouts"></a>

**Dispatch by** メニューで、任意のユーザー属性に基づいてユーザーにバリエーションを割り当てることができます。

例えば、25%のユーザーに機能をロールアウトすることができますが、ユーザーはランダムにバリエーションに割り当てられるのではなく、`team-region`属性の値に基づいてバリエーションに割り当てられます。これにより、FeatBitは一致する属性値ペアを持つすべてのユーザーに同じバリエーションを割り当てることができます。

以下はアドバンストロールアウトの画像です：

![](../../feature-flags/assets/targeting-users-with-flags/percentage-rollouts/002.webp)
