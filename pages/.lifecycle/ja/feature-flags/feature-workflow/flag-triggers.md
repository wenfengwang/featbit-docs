# フラグトリガー

### 概要 

このトピックでは、APMツールなどのサードパーティアプリケーションからリモートでフラグターゲティングに変更を加えることができるFeatBitのフラグトリガー機能の使用方法について説明します。トリガーを使用して、フラグターゲティングをオンまたはオフに切り替えることができます。

### フラグトリガーの機能を理解する 

トリガーを使用すると、一意のWebhook URLを使用してフラグの変更をリモートで開始できます。トリガーは既存のツールと統合され、特定の運用正常性のしきい値に達したとき、または特定のアラートを受信したときにフラグを有効または無効にすることができます。フラグには、複数のツールまたはアラートに複数のトリガーをアタッチできます。

トリガーは、機能フラグをサードパーティツールに接続するための一意のURLを作成することで機能します。サードパーティのツールが特定のアラートを生成すると、トリガーによってフラグのターゲット設定が **On** または **Off** に設定されます。

各URLは1つのアクションを制御し、URLは互いに異なります。フラグの **On** URLに対する後続のリクエストでは、最初のコンタクトがフラグを **On** にした後、フラグの状態は変更されません。

#### フラグトリガーのセキュリティについて

フラグトリガーはパブリックURLを使用しますが、機能フラグの変更を開始するための非常に安全な方法です。その理由は次のとおりです。

* トリガーは推測不可能なURLを使用し、
* **FeatBit** プロジェクト内の一部の人のみがトリガーを作成または変更できます。

推測できないURLは、機能的にアクセストークンと似ており、FeatBitと他のサービス間のアクティブな接続を必要としません。推測できないURLについて詳しくは、[Googleの推測できないURL](https://www.schneier.com/blog/archives/2015/07/googles_unguess.html)をご覧ください。

新しいトリガーを作成すると、そのURLは一度だけ表示され、ローカルにコピーするように求められます。最初の表示の後、URLは非表示になるため、フラグの **Triggers** タブの将来の閲覧者はそれを見ることができません。

トリガーのURLを紛失した場合は、トリガーの下部のアクションエリアからリセットできます。

#### 新しいフラグトリガーの作成 

個々の機能フラグのトリガーは、フラグの **Triggers** タブから作成できます。

トリガーを作成するには、次のようにします：

1. トリガーを作成する機能フラグに移動し、その **Triggers** タブをクリックします。
2. **Add** ボタンをクリックします。"Create trigger" ダイアログが表示されます:\

![](../../feature-flags/assets/feature-workflow/flag-triggers/001.png)

3. **Type** メニューから使用するツールを選択します。"Generic" を選択して、特定のツールに関連付けられていないトリガーを作成することもできます。
4. **Action** メニューからトリガーで実行するアクションを選択します。
5. **OK** をクリックします。確認が表示され、トリガーがフラグの **Triggers** タブに表示されます。
6. 一意のトリガーURLをコピーして保存します。今すぐこれを行う必要があります。このページを離れると、トリガーURLは不明瞭になり、再度表示できなくなります。

これで、フラグの新しいトリガーが作成されました。必要に応じて、**Add** をクリックして、さらにトリガーを作成できます。

### 既存のフラグトリガーの管理

既存のトリガーは、フラグの **Triggers** タブから変更できます。トリガーを作成したら、それを無効化、リセット、または削除できます。

既存のトリガーを変更するには、次のようにします：

1. トリガーを編集する機能フラグに移動し、その **Triggers** タブをクリックします。
2. 変更するトリガーを見つけます。
3. アクションエリアから必要なオプションを選択します。


![](../../feature-flags/assets/feature-workflow/flag-triggers/002.png)

* "Disable": このオプションを選択すると、トリガー構成は保存されますが、トリガーは機能停止します。トリガーを再度有効にするには、トグルを "Enable" に切り替えます。
* "Reset URL": このオプションを選択すると、FeatBitはこのトリガーの新しいURLを生成します。既存のトリガーのURLを紛失した場合にこのオプションを使用します。新しいURLを使用するには、このURLを使用するクライアントを更新する必要があります。**Reset** をクリックして新しいURLを生成します。
* "Remove": このオプションを選択すると、トリガーとそのURLが完全に削除されます。**Remove** をクリックしてトリガーを削除します。

## トリガーを呼び出す

トリガーを呼び出すには、トリガーの **URL** に対して **POST** リクエストを行います。他のパラメータは必要ありません。たとえば、curlを使用すると、次のようになります：

```bash
curl -X POST http://localhost:5000/api/v1/triggers/run/MTQyMDY5OTI0ODc2MQw4yPzGndlkezFEsZE_uPnA
```
