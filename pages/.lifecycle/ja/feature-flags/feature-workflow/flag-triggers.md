# フラグトリガー

### 概要

このトピックでは、FeatBitのフラグトリガー機能の使用方法について説明します。これにより、APMツールなどのサードパーティーアプリケーションからフラグのターゲティングをリモートで変更することができます。トリガーを使用して、フラグのターゲティングをオンまたはオフにすることができます。

### フラグトリガーの動作

トリガーを使用すると、一意のWebhook URL を使用してリモートでフラグの変更を開始できます。トリガーは既存のツールと統合して、特定の運用健康の閾値に達したり特定のアラートを受信した場合にフラグを有効または無効にできます。フラグには複数のトリガーが複数のツールやアラートに関連付けられることがあります。

トリガーは、フィーチャーフラグとサードパーティーツールを接続するための一意のURLを作成することで機能します。サードパーティーツールが特定のアラートを生成すると、トリガーはフラグのターゲティングを **オン** または **オフ** に設定します。

各URLは1つのアクションを制御し、URLは互いに異なります。フラグの **オン** URL への後続のリクエストは、初回の接触でフラグを **オン** に変更した後にフラグの状態を変更しません。

#### フラグトリガーのセキュリティの理解

フラグトリガーは公開URLを使用しますが、フィーチュアフラグへの変更を開始する非常に安全な方法です。その理由は次のとおりです。

* トリガーは推測不能なURL を使用し、かつ
* プロジェクト内の一部の人のみがトリガーの作成または変更を行うことができます。

推測不能なURL は、アクティブな接続を必要としないアクセス トークンと機能的に類似しています。推測不能なURL について詳しくは、[Googleの推測不能なURL](https://www.schneier.com/blog/archives/2015/07/googles\_unguess.html) を参照してください。

新しいトリガーを作成すると、そのURL は1度だけ表示され、ローカルにコピーするように促されます。初回の表示後、URL は非表示になるため、フラグの **トリガー** タブの将来の閲覧者はそれを表示することができません。

トリガーのURL を紛失した場合、トリガーの下部アクション領域からリセットすることができます。

#### 新しいフラグトリガーの作成

フラグの **トリガー** タブから個々のフィーチャーフラグのためのトリガーを作成できます。

トリガーを作成するには次の手順に従います。

1. 作成するトリガーのフィーチャーフラグに移動し、その **トリガー** タブにクリックします。
2. **追加** ボタンをクリックします。「トリガーの作成」ダイアログが表示されます：

![](../../feature-flags/assets/feature-workflow/flag-triggers/001.png)

3. **タイプ**メニューから使用するツールを選択します。特定のツールに関連付けられていないトリガーを作成するには、「汎用」を選択することもできます。
4. **アクション**メニューからトリガーで実行するアクションを選択します。
5. **OK** をクリックします。確認が表示され、トリガーがフラグの **トリガー** タブに表示されます。
6. 一意のトリガーURL をコピーして保存します。これを行わないと、このページを離れた後はトリガーURL が非表示になり、再度表示することはできません。

フラグに新しいトリガーが作成されました。必要に応じて **追加** をクリックしてさらにトリガーを作成できます。

### 既存のフラグトリガーの管理

フラグの **トリガー** タブから既存のトリガーを変更できます。トリガーを作成した後は、そのトリガーを無効にしたり、リセットしたり、削除したりすることができます。

既存のトリガーを変更するには次の手順に従います。

1. 変更するトリガーのフィーチャーフラグに移動し、その **トリガー** タブにクリックします。
2. 変更したいトリガーを見つけます。
3. アクション領域から希望するオプションを選択します：

![](../../feature-flags/assets/feature-workflow/flag-triggers/002.png)

* "無効にする"：このオプションを選択すると、トリガー構成は保存されますが、トリガーは動作を停止します。トリガーを再度有効にするには、トグルを "有効" に切り替えます。
* "URL をリセット"：このオプションを選択すると、FeatBit がこのトリガーのために新しいURL を生成します。既存のトリガーのURL を紛失した場合にこのオプションを使用します。このURL を使用しているクライアントを新しいURL に更新する必要があります。新しいURL を生成するには **リセット** をクリックします。
* "削除"：このオプションを選択すると、トリガーとそのURL は永久に削除されます。トリガーを削除するには **削除** をクリックします。

## トリガーの実行

トリガーを実行するには、トリガーの **URL** に **POST** リクエストを行います。他に必要なパラメータはありません。例えば、curl を使用して次のように行うことができます：

```bash
curl -X POST http://localhost:5000/api/v1/triggers/run/MTQyMDY5OTI0ODc2MQw4yPzGndlkezFEsZE_uPnA
```