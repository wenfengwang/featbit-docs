# フラグトリガー

### 概要 

このトピックでは、FeatBitのフラグトリガー機能の使用方法について説明します。フラグトリガー機能を使用すると、APMツールなどのサードパーティアプリケーションからフラグのターゲティングをリモートで変更することができます。トリガーを使用して、フラグのターゲティングをオンまたはオフにすることができます。

### フラグトリガーの機能 

トリガーは一意のウェブフックURLを使用してリモートでフラグの変更を開始することができます。トリガーは既存のツールと統合し、特定の運用健康の閾値を超えた場合や特定のアラートを受信した場合にフラグを有効または無効にすることができます。フラグには複数のトリガーが複数のツールまたはアラートに接続されることがあります。

トリガーは、フラグをサードパーティツールに接続するための一意のURLを作成します。サードパーティツールが特定のアラートを生成すると、トリガーはフラグのターゲティングを「オン」または「オフ」に設定します。

各URLは1つのアクションを制御し、URLは互いに異なります。フラグの「オン」URLへの後続のリクエストは、最初の接触後にフラグの状態を変更しません。

#### フラグトリガーのセキュリティの理解

フラグトリガーは公開URLを使用していますが、フィートビットを含めた他のサービスとのアクティブな接続を必要としません。以下にセキュリティの理由を示します：

* トリガーは予測できないURLを使用します
* フィートビットプロジェクト内の一部の人物のみがトリガーを作成または変更できます。

予測できないURLは、アクセストークンと機能的に類似しており、フィートビットと他のサービス間にアクティブな接続を必要としません。予測できないURLについて詳しくは、[Googleの予測不可能なURL](https://www.schneier.com/blog/archives/2015/07/googles\_unguess.html)を読んでください。

新しいトリガーを作成すると、そのURLは1回だけ表示され、ローカルにコピーするように促されます。初回の表示後、URLは非表示になり、フラグの「トリガー」タブの将来の閲覧者は表示できません。

トリガーのURLがわからなくなった場合は、トリガーの下部のアクションエリアからリセットすることができます。

#### 新しいフラグトリガーの作成 

フラグの「トリガー」タブから各個別の機能フラグのトリガーを作成することができます。

トリガーを作成するには、次の手順に従ってください：

1. トリガーを作成する機能フラグに移動し、「トリガー」タブに移動します。
2. **Add**ボタンをクリックします。"トリガーの作成"ダイアログが表示されます：

![](../../feature-flags/assets/feature-workflow/flag-triggers/001.png)

3. メニューの**Type**から使用するツールを選択します。特定のツールに関連付けられていないトリガーを作成するには、「汎用」を選択することもできます。
4. **Action**メニューからトリガーで実行するアクションを選択します。
5. **OK**をクリックします。確認が表示され、トリガーがフラグの「トリガー」タブに表示されます。
6. 一意のトリガーURLをコピーして保存します。これは今すぐ行う必要があります。このページを離れた後は、トリガーURLは非表示になり、再表示することはできません。

フラグに新しいトリガーが作成されました。必要に応じて、「Add」をクリックしてさらにトリガーを作成することができます。

### 既存のフラグトリガーの管理

フラグの「トリガー」タブから既存のトリガーを変更することができます。トリガーを作成した後は、無効にしたり、リセットしたり、削除したりすることができます。

既存のトリガーを変更するには、次の手順に従ってください：

1. トリガーを編集したい機能フラグに移動し、「トリガー」タブに移動します。
2. 変更したいトリガーを見つけます。
3. アクションエリアから選択したオプションを選択します：

![](../../feature-flags/assets/feature-workflow/flag-triggers/002.png)

* 「Disable」：このオプションを選択すると、トリガーの設定は保存されますが、トリガーは動作しなくなります。トリガーを再度有効にするには、トグルを「Enable」に切り替えます。
* 「Reset URL」：このオプションを選択すると、FeatBitはこのトリガーの新しいURLを生成します。既存のトリガーのURLを紛失した場合は、このオプションを使用します。新しいURLを使用するようにこのURLを使用しているクライアントを更新する必要があります。「Reset」をクリックして新しいURLを生成します。
* 「Remove」：このオプションを選択すると、トリガーとそのURLが完全に削除されます。トリガーを削除するには、「Remove」をクリックします。

## トリガーを実行する

トリガーを実行するには、トリガーのURLに**POST**リクエストを行います。他のパラメータは必要ありません。例えば、curlを使用して次のように実行できます：

```bash
curl -X POST http://localhost:5000/api/v1/triggers/run/MTQyMDY5OTI0ODc2MQw4yPzGndlkezFEsZE_uPnA
```