```markdown
import { Callout } from 'nextra/components'

# FeatBit REST API の使用

### 概要 <a href="#overview" id="overview"></a>

このガイドでは、FeatBit REST API の使用方法について説明します。API アクセストークンの作成方法、リクエストの作成方法、および応答の評価方法について説明します。一般的な使用例を紹介し、FeatBit API のドキュメントに慣れるのを支援します。

FeatBit REST API は、FeatBit ユーザーインターフェイス（UI）とのプログラミングによる相互作用の代替手段です。FeatBit API を使用して、フラグリストで利用可能なアクションを実行することができます。たとえば、REST API は、フィーチャーフラグの切り替え、セグメントの更新、およびカスタム統合の構築によく使用されます。

> FeatBit SDK を使用してフラグを評価する
>
> アプリケーションのコードでフィーチャーフラグを評価する場合、REST API を使用することは _推奨されていません_。代わりに、FeatBit SDK を使用してください。SDK には、フラグ値のキャッシングや更新のストリーミングなどの機能が含まれており、REST API を使用してフラグの値を評価する際に自動的に受け取れないものがあります。詳細については、[SDK を接続する](../getting-started/connect-an-sdk/)を参照してください。

このガイドでは、以下のことができます：

* アクセストークンの作成を含む、FeatBit API へのリクエストヘッダーの設定
* REST API を使用したFeatBit リソースの詳細の読み取り
* REST API を使用したFeatBit リソースの作成と更新
* REST API を使用した一般的な使用案件の学習

### 前提条件 <a href="#prerequisites" id="prerequisites"></a>

このガイドを完了するには、以下の前提条件を満たしている必要があります：

* ローカルまたはサーバー上で FeatBit が実行されていること。[インストール](../installation/full-installation.md)を読んでください。
* REST API へのリクエストを行うためのツールにアクセスできること。以下にその多くのオプションが記載されています：
  * [Curl](https://curl.se/)
  * [Postman](https://www.postman.com/)
  * [FeatBit API documentation](overview.md)

#### Curl <a href="#curl" id="curl"></a>

[Curl](https://curl.se/) は、REST API にリクエストを行うために使用できる一般的なコマンドラインツールです。このガイドでは、curl を使用しています。このガイドの例を自分のコマンドラインから実行できます。

#### Postman <a href="#postman" id="postman"></a>

[Postman](https://www.postman.com/) プラットフォームは、REST API にリクエストを行うための別のオプションです。リクエストの設定、実行、および保存のためのツールが提供されます。無料の Postman アカウントを作成して、このガイドの例を Postman クライアントから実行できます。

#### FeatBit API のドキュメント <a href="#launchdarkly-api-documentation" id="launchdarkly-api-documentation"></a>

FeatBit API ドキュメントでは、各ドキュメント化されたリクエストの例が提供されます。

#### FeatBit データ階層構造 <a href="#launchdarkly-data-hierarchy" id="launchdarkly-data-hierarchy"></a>

FeatBit アカウントには 1 つ以上の **プロジェクト** を含めることができます。プロジェクトには複数の **環境** を含めることができ、**フィーチャーフラグ** はプロジェクトの環境内に存在します。新しいフラグを作成すると、その環境内でのみ作成されます。すべてのフラグ構成設定は、各環境に固有です。1 つの環境で行う変更は、他の環境には適用されません。必要に応じて、すべての環境で同じフラグを一意の方法で構成できます。

多くのソフトウェアプロジェクトには、各プロジェクト内にテスト、ステージング、および本番環境があります。FeatBit では、組織のニーズに合った任意の環境構造を定義できます。たとえば、モバイルチームでは、「モバイルアプリ」のプロジェクト内に `android test`、`android prod`、`ios test`、および `ios prod` の環境が必要になるかもしれません。

### ヘッダーの設定 <a href="#setting-up-your-headers" id="setting-up-your-headers"></a>

作成するリクエストごとに必要なヘッダー情報があります。ヘッダーはキー/値のペアで構成されています。curl や Postman をはじめとするリクエストを行うための多くのツールは、これらのヘッダーをリクエストごとに自動的に保存します。

<Callout type="info">
Postman を使用している場合、**Host** と **Content-Length** ヘッダーが選択されていることを確認してください。これらの 2 つのヘッダーは、**curl** やその他のツールを使用している場合に自動的に追加されます。
</Callout>

#### 必須のヘッダー <a href="#required-headers" id="required-headers"></a>

すべてのリクエストには、`Authorization` ヘッダーが必要です。このヘッダーは、あなた自身を認証し、指定されたリソースに対して要求されたアクションを実行する権限があるかどうかを確認します。たとえば、プロジェクトに関する情報を要求しているが、そのプロジェクトに読み取りアクセス権限がない場合、応答は、十分な権限がないことを示すエラーになります。

`Authorization` ヘッダーの値は、API アクセストークンです。アクセストークンには個人用のものとサービストークンの両方があります。FeatBit で、**Integrations/Access tokens** ページからアクセストークンを作成することができます。このガイドでは、`ManageFeatureFlag` 権限を持つトークンが必要です。トークンを作成する際には、**ManageFeatureFlag** 権限（デフォルトで選択されています）を選択してください。

詳細については、[API アクセストークンの作成](../integrations/api-access-tokens.md)を参照してください。

SDK キーはアクセストークンとして使用できません

リクエスト本文を含むすべてのリクエストには、`Content-Type: application/json` という値を持つ `Content-Type` ヘッダーが必要です。リクエストに本文が含まれていない場合、API は `Content-Type` ヘッダーを無視します。つまり、API が要求していない場合でも、常に `Content-Type` ヘッダーを含めても安全です。

curl を使用してリクエストのために必要なヘッダーを含めるには、`-H` オプションを使用してください：

Curl の例

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/9d782f01-6ffb-4a7c-83a2-79304d801a46/feature-flags' \  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \  -H 'Content-Type: application/json'COPY
```

この例では、`-X` オプションがリクエストのタイプ、`PATCH` を指定しています。URL は、リクエストが作用するリソースを指定しています。各 `-H` オプションは、リクエストに含められるヘッダーを指定しています。リクエストを行うたびに、`-X`、リクエストタイプ、URL、およびヘッダーを含める必要があります。

### フラグ リストの読み取りの練習 <a href="#exercise-reading-flag-and-environment-information" id="exercise-reading-flag-and-environment-information"></a>

#### 環境 ID を取得する <a href="#reading-a-flag" id="reading-a-flag"></a>

前述のように、フィーチャーフラグは環境に固有です。環境のフラグリストを表示するには、環境 ID が必要です（実際には、環境キーを指定して API を呼び出すことが可能になります）。

環境 ID を取得するには：

1. **Organization** ページに移動し、**Projects** タブをクリックします。
2. プロジェクトリストから、接続したいプロジェクトと環境を見つけます。
3. **Copy Id** ボタンをクリックし、環境 ID がクリップボードにコピーされます

![](../api-docs/assets/using-featbit-rest-api/001.png)

#### API の呼び出し

前の手順で取得した環境 ID を使用して、以下のコールを作成します

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/[YOUR ENVIRONMENT ID]/feature-flags?pageIndex=0&pageSize=10&isEnabled=' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN'
  -H 'Content-Type: application/json'
```

このリクエストへの応答は、`200` 成功コードと、その環境のフィーチャーフラグに関するすべてを含む JSON オブジェクトです。例：

```json
{
    "success": true,
    "errors": [],
    "data": {
        "totalCount": 1,
        "items": [
            {
                "id": "e3d78102-8a67-4698-a744-afcb005e8dfa",
                "name": "flag 1",
                "description": "",
                "key": "flag-1",
                "isEnabled": false,
                "variationType": "boolean",
                "variations": [
                    {
                        "id": "838b01b2-d443-4317-b8d3-adb2bed483c0",
                        "value": "true"
                    },
                    {
                        "id": "0c742a83-0053-4f37-8f34-9ef164c17875",
                        "value": "false"
                    }
                ],
                "updatedAt": "2023-03-20T05:44:15.765Z",
                "serves": {
                    "enabledVariations": [
                        "true"
                    ],
                    "disabledVariation": "false"
                },
                "tags": []
            }
        ]
    }
}
```
```