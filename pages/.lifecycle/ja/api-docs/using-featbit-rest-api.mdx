import { Callout } from 'nextra/components'

# FeatBit REST API の使用

### 概要 <a href="#overview" id="overview"></a>

このガイドでは、FeatBit REST API の使用を開始する方法について説明します。API アクセストークンの作成、リクエストの実行、レスポンスの評価方法について説明します。一般的なユースケースを紹介し、FeatBit API ドキュメントに慣れるのに役立ちます。

FeatBit REST API は、FeatBit ユーザーインターフェース (UI) との対話に代わるプログラム的な方法です。FeatBit API を使用して、フラグリストで利用可能な任意のアクションを実行できます。これには、フラグの作成や操作が含まれます。例えば、REST API は機能フラグの切り替え、セグメントの更新、カスタム統合の構築などによく使用されます。

> FeatBit SDK を使用してフラグを評価する
>
> アプリケーションのコード内で機能フラグを評価するために REST API を使用することは推奨しません。その代わりに、FeatBit SDK を使用してください。SDK には、フラグ値のキャッシュや更新のストリーミングなどの機能が含まれており、REST API を使用してフラグ値を評価した場合には自動的には得られません。詳細は [SDK の接続](../getting-started/connect-an-sdk/) をご覧ください。

このガイドでは、以下を行います：

* FeatBit API へのアクセスに必要なリクエストヘッダーを設定します。これにはアクセストークンの作成が含まれます。
* REST API を使用して FeatBit リソースの詳細を読み取ります。
* REST API を使用して FeatBit リソースを作成および更新します。
* REST API を使用する一般的なユースケースを学びます。

### 前提条件 <a href="#prerequisites" id="prerequisites"></a>

このガイドを完了するためには、以下の前提条件が必要です：

* FeatBit をローカルまたはサーバー上で実行していること。[インストール方法](../installation/full-installation.md)をご覧ください。
* REST API を呼び出すためのツールへのアクセス。以下に多くのオプションが説明されています：
  * [Curl](https://curl.se/)
  * [Postman](https://www.postman.com/)
  * [FeatBit API ドキュメント](overview.md)

#### Curl <a href="#curl" id="curl"></a>

[Curl](https://curl.se/) は、REST API への呼び出しに使用できる一般的なコマンドラインツールです。このガイドでは例として curl を使用しています。このガイドの例は、あなたのコマンドラインから実行することができます。

#### Postman <a href="#postman" id="postman"></a>

[Postman](https://www.postman.com/) プラットフォームは、REST API への呼び出しに別のオプションを提供します。REST リクエストの設定、実行、保存のためのツールを提供します。無料の Postman アカウントを作成し、このガイドの例を Postman クライアントから実行することができます。

#### FeatBit API ドキュメント <a href="#launchdarkly-api-documentation" id="launchdarkly-api-documentation"></a>

FeatBit API ドキュメントには、文書化された各リクエストの例が掲載されています。

#### FeatBit データ階層 <a href="#launchdarkly-data-hierarchy" id="launchdarkly-data-hierarchy"></a>

FeatBit アカウントは、1つ以上の**プロジェクト**を含むことができます。プロジェクトには複数の**環境**が含まれ、**機能フラグ**はプロジェクトのある環境内に存在します。新しいフラグを作成すると、そのフラグはその環境内でのみ作成されます。すべてのフラグ設定は各環境に特有です。ある環境で行った変更は他の環境には適用されません。必要に応じて、すべての環境で同じフラグをユニークな方法で設定することができます。

多くのソフトウェアプロジェクトには、テスト、ステージング、本番環境が各プロジェクト内にあります。FeatBit では、組織のニーズに合わせた任意の環境構造を定義できます。例えば、モバイルチームは「モバイルアプリ」プロジェクト内に `android_test`、`android_prod`、`ios_test`、`ios_prod` といった環境が必要かもしれません。

### ヘッダーの設定 <a href="#setting-up-your-headers" id="setting-up-your-headers"></a>

あなたが行う各リクエストには必要なヘッダー情報が含まれています。ヘッダーはキー/値のペアで構成されます。curl や Postman など、リクエストを行うための多くのツールは、これらのヘッダーをリクエスト間で保存します。

<Callout type="info">
Postman を使用している場合は、**Host** ヘッダーと **Content-Length** ヘッダーが選択されていることを確認してください。これらのヘッダーは、curl やその他のツールを使用している場合に自動的に追加されます。
</Callout>

#### 必須ヘッダー <a href="#required-headers" id="required-headers"></a>

すべてのリクエストには `Authorization` ヘッダーが必要です。このヘッダーはあなたを認証し、指定されたリソースに対する要求されたアクションを実行する権限があるかどうかを確認します。例えば、プロジェクトに関する情報を要求するが、そのプロジェクトに対する読み取りアクセス権がない場合、レスポンスは権限不足を示すエラーになります。

`Authorization` ヘッダーの値は API アクセストークンです。アクセストークンは、個人トークンまたはサービストークンのいずれかです。FeatBit では、**Integrations/Access tokens** ページからアクセストークンを作成できます。このガイドでは、機能フラグの**ManageFeatureFlag**権限を持つトークンが必要ですので、トークンを作成する際には**ManageFeatureFlag**権限（デフォルトで選択されています）を選択してください。

詳細は [API アクセストークンの作成](../integrations/api-access-tokens.md) をご覧ください。

SDK キーをアクセストークンとして使用することはできません。

リクエスト本文を含むすべてのリクエストには、`Content-Type` ヘッダーが必要で、その値は `application/json` です。リクエストに本文が含まれていない場合、API は `Content-Type` ヘッダーを無視します。これは、API がそれを要求しない場合でも、`Content-Type` ヘッダーを常に含めることが安全であることを意味します。

リクエストに必要なヘッダーを curl に含めるには、`-H` オプションを使用します。

curl の例

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/9d782f01-6ffb-4a7c-83a2-79304d801a46/feature-flags' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \
  -H 'Content-Type: application/json'
```

この例では、`-X` オプションでリクエストのタイプを指定しています。URL はリクエストが対象とするリソースを指定しています。各 `-H` オプションはリクエストに含めるヘッダーを指定しています。curl を使用してリクエストを行う際には、リクエストタイプ、URL、およびヘッダーを毎回含める必要があります。

### 演習: フラグリストの読み取り <a href="#exercise-reading-flag-and-environment-information" id="exercise-reading-flag-and-environment-information"></a>

#### 環境 ID の取得 <a href="#reading-a-flag" id="reading-a-flag"></a>

前述のように、機能フラグは環境固有です。環境の機能フラグを一覧表示するには、環境 ID が必要です（将来的には、環境キーを使用して API を呼び出すことが可能になる予定です）。

環境 ID を取得するには：

1. **Organization** ページに移動し、**Projects** タブをクリックします。
2. プロジェクトリストから、接続したいプロジェクトと環境を見つけます。
3. **Copy Id** ボタンをクリックすると、環境 ID がクリップボードにコピーされます。

![](../api-docs/assets/using-featbit-rest-api/001.png)

#### API の呼び出し

前の手順で取得した環境 ID を使用して、以下の呼び出しを行います：

```bash
curl -X GET 'http://localhost:5000/api/v1/envs/[YOUR ENVIRONMENT ID]/feature-flags?pageIndex=0&pageSize=10&isEnabled=' \
  -H 'Authorization: EXAMPLE-API-ACCESS-TOKEN' \
  -H 'Content-Type: application/json'
```

このリクエストへのレスポンスは `200` の成功コードと、その環境の機能フラグに関するすべてを含む JSON オブジェクトです。例えば：

```json
{
    "success": true,
    "errors": [],
    "data": {
        "totalCount": 1,
        "items": [
            {
                "id": "e3d78102-8a67-4698-a744-afcb005e8dfa",
                "name": "flag 1",
                "description": "",
                "key": "flag-1",
                "isEnabled": false,
                "variationType": "boolean",
                "variations": [
                    {
                        "id": "838b01b2-d443-4317-b8d3-adb2bed483c0",
                        "value": "true"
                    },
                    {
                        "id": "0c742a83-0053-4f37-8f34-9ef164c17875",
                        "value": "false"
                    }
                ],
                "updatedAt": "2023-03-20T05:44:15.765Z",
                "serves": {
                    "enabledVariations": [
                        "true"
                    ],
                    "disabledVariation": "false"
                },
                "tags": []
            }
        ]
    }
}
```

