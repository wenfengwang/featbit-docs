# 本番環境でのテスト

> **本番環境でのテスト**とは何ですか
>
> 本番環境を完全に再現することは不可能です。実際のユーザーで特徴をテストするためには、実際のユーザーと一緒にテストするしかありません。フィーチャーフラグを使用すると、本番環境で安全にテストするために必要な制御が得られます。FeatBitのターゲット機能を活用して、新しい機能を特定のユーザーの一部に公開することができます。システムのパフォーマンスが低下した場合、展開を停止してインシデントの影響範囲を制限することができます。しかし、うまくいけば、新しい機能を徐々に広い観客にリリースすることができます。

## 必要条件

前提条件として、次の「はじめに」のチュートリアルをすべて完了しているものとします。

* チュートリアル「[デモ用に2つのフラグを作成する](../create-two-feature-flags.md)」で、`game runner`と`difficulty mode`の2つのフィーチャーフラグを正常に作成したこと。
* 「`Dino Game`デモ」との相互作用に基本的な経験があることを[知っていますか？](../try-interacting-with-the-demo.md)。
* プログラムまたは「Dino Game」デモに[SDKを接続する方法](../connect-an-sdk/)を知っています：
  * デモのコードサンプルをダウンロードする
  * SDKを初期化する
  * カスタマイズされたプロパティを持つユーザーを識別する。
  * フィーチャーフラグを実装して、機能を提供し、制御します。

## 個別のユーザーを使用して本番環境でテストする

ゲームはオンラインで展開されました。全プレイヤーにリリースする前に、いくつかの身近な友人でテストしたいと思います。友人を「許可リスト」に追加するために、「ユーザーのターゲティング」セクションを使用できます。

「game runner」フィーチャーフラグのターゲティングページに移動し、セクション「ユーザーのターゲティング」を展開します。各バリエーション`true`と`false`の2つの選択リストが表示されます。

友人を「許可リスト」に追加するためには、次の手順を実行します。

1. 友人のゲームユーザー名を`true`の下の選択リストに追加します。
2. フィーチャーフラグをオンにします。
3. デフォルトのルールを`false`に設定します。

上記の3つの手順を実行すると、FeatBitにフィーチャーフラグ「game runner」がオンになったことが伝えられます。ターゲティングユーザーセクションのtrueリストにあるユーザーのみが`true`バリエーション（ゲームをプレイできる）を持つことができます。

![](../../getting-started/assets/testing-in-production/001.webp)

### ユーザーはどこから来るのですか？

trueリストのユーザーは次の3つの方法でインポートできます。

1. 「Data sync」セクションで、予め定義されたJSONファイルを介して、すべてのユーザーをFeatBitにインポートすることができます。
![](../../getting-started/assets/testing-in-production/002.webp)
2. ユーザーが実行中のアプリケーションに登録した場合、ユーザー情報がシステムに保存されます。
![](../../getting-started/assets/testing-in-production/003.webp)
3. ユーザー名を「ユーザーのターゲティング」の選択リストに直接入力することもできます。ユーザーが存在しない場合は、「最終ユーザー」リストに新しいユーザーが追加されます。

ユーザーの情報は「最終ユーザー」ページで確認することができます。

![](../../getting-started/assets/testing-in-production/004.webp)

## QAセグメントを使用して本番環境でテストする

友人はあなたのゲームが好きで、公開前に常に新機能をテストしたいと思っています。彼らはテストのための再利用可能なユーザー（QAチームのようなもの）になりました。次回新しい機能をリリースする際に作業を楽にするために、QAセグメントを作成することができます。このセグメントは、ゲームの新機能を展開するたびに使用されます。

「セグメント」ページに移動し、「my lovely QA team」という名前のセグメントを作成します。

![](../../getting-started/assets/testing-in-production/005.webp)

セグメントの詳細ページでは、「Including users」リストにテストユーザーを追加し、保存をクリックします。このセグメントは、異なるフィーチャーフラグ間で共有することができます。

![](../../getting-started/assets/testing-in-production/006.webp)

フィーチャーフラグリストに戻り、「game runner」フィーチャーフラグの「Targeting」ページを開きます。

1. 「ユーザーのターゲティング」セクションのtrueリストからすべてのユーザーを削除します。
2. 「my lovely QA team」をカスタマイズされたルールに追加します。
   1. 新しいカスタマイズされたルールを追加し、名前を付けます（例：「本番環境でのテストルール」）。
   2. IF条件として「ユーザーがセグメントに所属する」を選択します。
   3. セクションリストに「my lovely QA team」を選択します。
   4. サーブエリアに`true`を選択します。

![](../../getting-started/assets/testing-in-production/007.webp)

上記の設定は、ユーザーが「my lovely QA team」セグメントに所属している場合、DinoGameがこのユーザーにリリースされることを意味します。この設定は、「difficulty mode」などの他の機能の本番環境でのテストのために他のフィーチャーフラグでも実装することができます。

![](../../getting-started/assets/testing-in-production/008.webp)

セグメントは再利用可能なセグメントとも呼ばれ、異なるフィーチャーフラグで使用できます。セグメントを更新すると、このセグメントを使用するすべてのフィーチャーフラグが更新されます。