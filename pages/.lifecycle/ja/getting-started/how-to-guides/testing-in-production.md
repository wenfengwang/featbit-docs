# 本番環境でのテスト

> **本番環境でのテスト**とは何か？
>
> 本番環境を完全に再現することは不可能です。機能が実際の世界でどのように動作するかを知る唯一の確実な方法は、実際のユーザーを使ってテストすることです。機能フラグを使用することで、本番環境で安全にテストを行うために必要なコントロールを得ることができます。FeatBitのターゲティング機能を利用して、新機能を特定のユーザーのサブセットに公開します。システムパフォーマンスが低下した場合、ロールアウトを停止してインシデントの影響範囲を限定することができます。しかし、すべてが順調であれば、新機能を徐々に広い範囲のユーザーにリリースすることができます。

## 前提条件

「はじめに」の最後の3つのチュートリアルを既に完了していることを前提としています。

* チュートリアル[デモ用に2つのフラグを作成する](../create-two-feature-flags.md)で、`game_runner`と`difficulty_mode`の2つの機能フラグを正常に作成しました。
* [「Dino Game」デモとの対話を試す](../try-interacting-with-the-demo.md)方法についての基本的な経験があります。
* [SDKを接続する](../connect-an-sdk/)方法を知っており、プログラムまたは「Dino Game」デモに適用できます：
  * デモコードサンプルをダウンロード
  * SDKを初期化
  * カスタマイズされたプロパティを持つユーザーを識別
  * 機能フラグを実装して、機能を提供し制御する

## 本番環境でテストするために個々のユーザーを使用する

ゲームはオンラインでデプロイされています。すべてのプレイヤーにリリースする前に、親しい友人たちとテストしたいと考えています。「ユーザーのターゲティング」セクションを使用して、友人たちを「許可リスト」に追加できます。

「game_runner」機能フラグのターゲティングページに移動し、「ユーザーのターゲティング」セクションを展開します。`true`と`false`の各バリエーションに対して2つの選択リストが表示されます。

友人たちを「許可リスト」に追加するには、以下の手順を実行します：

1. `true`の下にある選択リストに友人たちのゲームユーザーネームを追加します。
2. 機能フラグをオンにします。
3. デフォルトルールを`false`に設定します。

上記の3ステップは、機能フラグ「game_runner」がオンになっており、`true`リストにあるユーザーのみが`true`のバリエーション（ゲームをプレイできる）を持つことをFeatBitに伝えます。

![](../../getting-started/assets/testing-in-production/001.webp)

### ユーザーはどこから来るのか？

`true`リストのユーザーは、次の3つの方法でインポートできます：

1. 「データ同期」セクションで、事前定義されたJSONファイルを通じてすべてのユーザーをFeatBitにインポートできます。
![](../../getting-started/assets/testing-in-production/002.webp)
2. 実行中のアプリケーションでユーザーが登録されると、そのユーザー情報がシステムに保存されます。
![](../../getting-started/assets/testing-in-production/003.webp)
3. 「ユーザーのターゲティング」選択リストに直接ユーザーネームを入力することもできます。ユーザーが存在しない場合、新しいユーザーが「エンドユーザー」リストに追加されます。

ユーザー情報は「エンドユーザー」ページで見つけることができます。

![](../../getting-started/assets/testing-in-production/004.webp)

## 本番環境でテストするためにQAセグメントを使用する

あなたの友人たちはあなたのゲームが気に入り、一般公開前に常に新機能をテストしたいと考えています。彼らはテスト用の再利用可能なユーザーになりました（QAチームのようなものです）。次回新機能をリリースする際に作業を簡単にするために、QAセグメントを作成し、このセグメントはゲームの新機能をデプロイするたびに使用されます。

「セグメント」ページに移動し、「my_lovely_QA_team」という名前のセグメントを作成します。

![](../../getting-started/assets/testing-in-production/005.webp)

セグメントの詳細ページで、私の素敵なテストユーザーたちを「Including users」リストに追加し、保存をクリックします。このセグメントは異なる機能フラグ間で共有できます。

![](../../getting-started/assets/testing-in-production/006.webp)

機能フラグリストに戻り、「game_runner」機能フラグの「Targeting」ページを開きます。

1. 「ユーザーのターゲティング」セクションの`true`リストにあるすべてのユーザーを削除します。
2. カスタマイズルールに「my_lovely_QA_team」を追加します。
   1. 新しいカスタマイズルールを追加し、名前を付けます（例：「本番環境でのテストルール」）。
   2. IF条件として「User is in segment」を選択します。
   3. セクションリストで「my_lovely_QA_team」を選択します。
   4. サーブエリアで`true`を選択します。

![](../../getting-started/assets/testing-in-production/007.webp)

上記の設定は、ユーザーが「my_lovely_QA_team」セグメントに属している場合、DinoGameがそのユーザーにリリースされることを意味します。この設定は、「difficulty_mode」などの他の機能に対しても、本番環境でのテストのために他の機能フラグに実装できます。

![](../../getting-started/assets/testing-in-production/008.webp)

このセグメントはまた、再利用可能なセグメントとも呼ばれ、異なる機能フラグで使用できます。一つのセグメントを更新することは、このセグメントを使用するすべての機能フラグを更新することを意味します。
