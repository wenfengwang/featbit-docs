import { Callout } from 'nextra/components'

# APIを使用して機能フラグを取得する

このドキュメントでは、対象のSDKが利用できない場合にサーバーから直接機能フラグを取得する方法についての包括的なガイドを提供します。

Evaluation Serverは、クライアントサイドとサーバーサイドの両プラットフォーム用に、目的の環境に特化した機能フラグを簡単に取得できる2つのAPIを提供しています。

クライアントサイドとサーバーサイドのSDKの違いは以下の通りです：

* クライアントサイドSDKは単一ユーザー用ですが、サーバーサイドSDKは複数ユーザー用です
* クライアントサイドSDKはEvaluation Serverに全てのフラグの評価を依存していますが、サーバーサイドSDKはフラグをローカルで評価します

<Callout type="info" emoji="ℹ️">
APIリクエスト内の`{Host}`をあなたの環境に適したホストURLに置き換える必要があります。`{Host}`は、評価サーバーホストまたはFeatBitエージェントホストのいずれかになりますが、どちらも同じAPIを提供しています。
</Callout>

## クライアントサイド

クライアントサイドのリクエストでは、`Authorization`ヘッダーにクライアント環境シークレットを提供します。

**リクエスト**

```bash
curl -X POST {Host}/api/public/sdk/client/latest-all \
-H 'Content-Type: application/json' \
-H 'Authorization: client-env-secret' \
-d '{
    "keyId": "bot-id",
    "name": "bot",
    "customizedProperties": [
        {
            "name": "level",
            "value": "high"
        },
        {
            "name": "location",
            "value": "us"
        }
    ]
}'
```

**レスポンス**

```json
[
    {
       "id":"hello-world",
       "variation":"true",
       "variationType":"boolean"
    }
]
```

## サーバーサイド

サーバーサイドのリクエストでは、`Authorization`ヘッダーにサーバー環境シークレットを提供します。

**リクエスト**

```bash
curl -H "Authorization: server-env-secret" {Host}/api/public/sdk/server/latest-all
```

**レスポンス**

```json
{
   "messageType":"data-sync",
   "data":{
      "eventType":"full",
      "featureFlags":[
         {
            "envId":"1331554d-98c4-41fe-ade4-68e6f5eeb54a",
            "name":"hello world",
            "key":"hello-world",
            "variationType":"boolean",
            "variations":[
               {
                  "id":"bbe8f444-090e-4a3b-99fa-b487bab424aa",
                  "value":"true"
               },
               {
                  "id":"cf8f9626-0d6f-4d05-a98f-8c3a50c85d0f",
                  "value":"false"
               }
            ],
            "targetUsers":[
               
            ],
            "rules":[
               
            ],
            "isEnabled":true,
            "disabledVariationId":"cf8f9626-0d6f-4d05-a98f-8c3a50c85d0f",
            "fallthrough":{
               "dispatchKey":null,
               "includedInExpt":true,
               "variations":[
                  {
                     "id":"bbe8f444-090e-4a3b-99fa-b487bab424aa",
                     "rollout":[
                        0,
                        1
                     ],
                     "exptRollout":1
                  }
               ]
            },
            "exptIncludeAllTargets":true,
            "tags":[
               
            ],
            "isArchived":false,
            "disabledVariation":{
               "id":"cf8f9626-0d6f-4d05-a98f-8c3a50c85d0f",
               "value":"false"
            },
            "creatorId":"b58fa8fd-eca2-460a-ab0f-e7758dbcec6a",
            "updatorId":"b58fa8fd-eca2-460a-ab0f-e7758dbcec6a",
            "createdAt":"2023-03-16T09:11:23.739Z",
            "updatedAt":"2023-03-16T09:11:26.0465535Z",
            "id":"4daca70f-86ae-4468-aee8-afc700977202"
         }
      ],
      "segments":[
         {
            "envId":"1331554d-98c4-41fe-ade4-68e6f5eeb54a",
            "name":"beta users",
            "description":"これはベータユーザーのためのセグメントです",
            "included":[
               
            ],
            "excluded":[
               
            ],
            "rules":[
               
            ],
            "isArchived":false,
            "createdAt":"2023-03-16T09:18:21.1317917Z",
            "updatedAt":"2023-03-16T09:18:21.1317248Z",
            "id":"b2b91bbe-5d54-4d8a-882f-afc700995b23"
         }
      ]
   }
}
```
