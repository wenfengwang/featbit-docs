# APIアクセス・トークン

### 概要

このトピックでは、FeatBit REST APIでの認証にAPIアクセス・トークンを使用する方法、およびそれらの制約と実装の提案について説明します。

> APIアクセス・トークンはプライベートです
>
> 作成したトークンの秘密の値にアクセスできるのはあなただけです。他のアカウントメンバーはそれにアクセスできません。管理者はあなたのトークンを削除できますが、その値を表示することはできません。

### 個人用APIアクセス・トークンのスコープ設定

APIトークンを利用して行える操作のセットを制限するために、APIトークンのスコープを設定することができます。例として、REST APIに対して読み取りアクセスのみを行う統合を構築することができます。

### アクセス・トークンの権限に関する理解

> 個人用APIアクセス・トークンと最小特権の原則
>
> ベストプラクティスとして、統合に必要な最小のスコープを持つようにトークンに権限を与えることを推奨します。例えば、統合が本番環境を変更することを意図していない場合は、必要なアクセスに応じて特定の権限アクションを使用してアクセスを適切に制限してください。

FeatBitでは、2種類のトークンを作成することができます。アカウントメンバーのアカウントに関連付けられた個人用トークン、または作成元のアカウントに依存しないサービストークンです。

これらのトークンタイプは、作成元の権限が変更されると異なるように反応します。そのため、異なることに対して異なる種類のトークンを使用することが望ましい場合があります。

#### 個人用トークン

個人用アクセス・トークンを構成して、自分の権限と同じ権限を持たせることができます。個人用トークンは、FeatBitでできることを超えることはありません。

自分の権限が減少した場合、作成した個人用トークンのスコープも減少します。例えば、**ManageFeatureFlag**権限を持っており、個人用トークンを作成したがその後その権限が削除された場合、トークンも同様にダウングレードされます。そのトークンを使用して機能フラグにリクエストを行った場合、FeatBitからは以下の結果が返されます:

```json
{
    "success": false,
    "errors": [
        "Forbidden"
    ],
    "data": null
}
```

個人用アクセス・トークンを持つアカウントメンバーがFeatBitチームから削除された場合、彼らの個人用トークンは無効になります。

一時的な利用や個人用途でFeatBit APIにアクセスしたい場合は、個人用トークンを使用してください。

#### サービストークン

個人用トークンとは異なり、サービストークンはFeatBitプロファイルには紐づいていません。既存の権限をサービストークンに割り当てることはできますが、サービストークンには自分より多くの権限を与えることはできません。

サービストークンの権限は作成後に恒久的に固定されます。サービストークンの権限を編集することはできず、自分の権限が変更されても、サービストークンの権限は変わりません。

FeatBit APIとの長期的な連携を作成する場合は、サービストークンを使用してください。

### APIアクセス・トークンの作成

APIアクセス・トークンは**Integrations/Access tokens**ページから作成することができます。

デフォルトでは、作成するトークンは個人用トークンです。トークン作成中に代わりにサービストークンを作成することも選択できます。

> 新しいトークンをすぐに保存する
>
> APIアクセス・トークンは作成後すぐに1度だけ表示されます。トークンが表示されているページを離れたり更新すると、トークンが見えなくなります。作成ページを離れる前に、新しいアクセス・トークンを安全な場所にコピーして保存する必要があります。

以下は**Access tokens**ページのスクリーンショットです：

![](../integrations/assets/api-access-tokens/001.webp)

アクセス・トークンを作成する手順は以下の通りです：

1. **Integrations/Access tokens**ページに移動します。
2. ページ右上の**Add**ボタンをクリックすると、**Add Access Token**パネルが表示されます\

![](../integrations/assets/api-access-tokens/002.png)

3. トークンにわかりやすい**名前**を付けます。
4. ドロップダウンリストからトークンの種類を選択します。
5. サービストークンの場合は許可する権限を割り当てます。
6. **Save**ボタンをクリックします。
7. トークンを安全な場所にコピーして保存します。このページを離れた後、トークンは見えなくなります。

トークンを作成した後、その名前を編集したり、有効化や無効化、削除を行うことができます。また、このページから既存のトークンを管理することもできます。

### アクセス・トークンの管理

アクセス・トークンを管理する手順は以下の通りです：

1. **Integrations/Access tokens**ページに移動します。
2. 一覧からトークンを見つけます。
3. デリートメニューをクリックし、メニューから選択します:\

   * Edit: アクセス・トークンの名前を変更します。
   * Activate/Deactivate: トークンの状態を切り替えます。トークンの状態が**active**の場合のみ使用可能です。それ以外の場合、そのトークンを使用したAPI呼び出しはForbidden応答を返します。
   * Remove: トークンを削除します。このアクションを実行すると、トークンは元に戻せず、もう使用することはできません。

以下は編集と削除オプションのスクリーンショットです：

![](../integrations/assets/api-access-tokens/003.png)

### APIアクセス・トークンの作成、管理を制限する方法

デフォルトでは、**Owner**、**Administratot**、または**Developer**のポリシーを持つすべてのアカウントメンバーが、既存の権限に制限されたアクセス・トークンを作成することができます。アクセス・トークンリソースに関連する3つの権限が存在します：

* ListAccessTokens
* ManagePersonalAccessTokens
* ManageServiceAccessTokens

IAMポリシーによって、これらのアクションを追加/削除することで、アカウントメンバーがアクセス・トークンを作成または管理できないように制限することができます。以下は、アクセス・トークンに関連するIAMポリシーのスクリーンショットです。

![](../integrations/assets/api-access-tokens/004.png)