# APIアクセストークン

### 概要

このトピックでは、FeatBit REST APIで認証するためにAPIアクセストークンを使用する方法、およびそれらを実装する際の制約と提案について説明します。

> APIアクセストークンはプライベートです
>
> 作成したトークンの秘密の値にアクセスできるのはあなただけです。他のアカウントメンバーはアクセスできません。管理者はトークンを削除することはできますが、その値を見ることはできません。

### 個人APIアクセストークンのスコープ

APIトークンのスコープを限定して、実行可能な操作のセットを制限することができます。例えば、REST APIに対して読み取りアクセスのみを持つ統合を構築することができます。

### アクセストークンの権限についての理解

> 個人APIアクセストークンと最小権限の原則
>
> ベストプラクティスとして、トークンには統合に必要な最小限のスコープを与えることを推奨します。例えば、統合が本番環境を変更することを意図していない場合、ニーズに応じて特定の権限アクションを使用して適切にアクセスを制限するべきです。

FeatBitでは、2種類のトークンを作成することができます。アカウントメンバーのアカウントにリンクされた個人トークン、またはその作成者のアカウントから独立したサービストークンです。

トークンの種類によって、作成者の権限が変更されたときの反応が異なります。このため、異なるタイプのトークンを異なる用途で使用することを検討するかもしれません。

#### 個人トークン

個人アクセストークンは、あなたが持っているのと同じ権限を持つように設定できます。あなたの個人トークンは、FeatBitであなたができる以上のことは決してできません。

もし自分の権限が削減された場合、作成した個人トークンのスコープも同様に縮小されます。例えば、**ManageFeatureFlag** 権限を持っていて個人トークンを作成したが、後にその権限が削除された場合、トークンもダウングレードされます。そのトークンでフィーチャーフラグにリクエストを行うと、FeatBitは以下の結果を返します：

```json
{
    "success": false,
    "errors": [
        "Forbidden"
    ],
    "data": null
}
```

個人アクセストークンを持つアカウントメンバーがFeatBitチームから削除された場合、その個人トークンは無効化されます。

一時的または個人的な使用のためにFeatBit APIにアクセスしたい場合は、個人トークンを使用してください。

#### サービストークン

個人トークンとは異なり、サービストークンはあなたのFeatBitプロファイルに紐付けられていません。既存の権限をサービストークンに割り当てることはできますが、サービストークンに自分が持っている以上の権限を与えることはできません。

サービストークンの権限は、作成した後に永続的に固定されます。サービストークンの権限を編集することはできず、あなたの権限が変更されたとしても、サービストークンの権限はそのままです。

FeatBit APIとの長期的な統合を作成するためにサービストークンを使用してください。

### APIアクセストークンの作成

APIアクセストークンは、**Integrations/Access tokens**ページから作成できます。

デフォルトでは、作成されるトークンは個人トークンです。トークン作成ワークフロー中にサービストークンを作成することを選択することもできます。

> 新しいトークンはすぐに保存してください
>
> APIアクセストークンは、作成直後に一度だけ表示されます。トークンが表示されるページから離れたり、ページを更新したりすると、トークンは隠されて再び表示されなくなります。新しいアクセストークンを作成ページを離れる前にコピーして安全な場所に保存しておかないと、トークンへのアクセスが失われます。

**Access tokens**ページのスクリーンショットはこちらです：

![](../integrations/assets/api-access-tokens/001.webp)

アクセストークンを作成するには：

1. **Integrations/Access tokens**ページに移動します。
2. ページの右上にある**Add**ボタンをクリックすると、**Add Access Token**パネルが表示されます\

![](../integrations/assets/api-access-tokens/002.png)

3. トークンにわかりやすい**Name**を付けます。
4. ドロップダウンリストからトークンのタイプを選択します。
5. サービストークンの場合、トークンに付与したい権限を割り当てます。
6. **Save**ボタンをクリックします。
7. トークンをコピーして安全な場所に保存します。このページを離れた後、トークンは隠されます。

トークンを作成した後、その名前を編集したり、有効化、無効化、または削除したりすることができます。このページから既存のトークンも管理できます。

### アクセストークンの管理

アクセストークンを管理するには：

1. **Integrations/Access tokens**ページに移動します。
2. リストからトークンを見つけます。
3. トークンの**overflow menu**をクリックし、メニューから選択します：

   * 編集：アクセストークンの名前を変更します。
   * アクティブ/非アクティブ：トークンのステータスを切り替えます。トークンは、ステータスが**active**の場合にのみ使用できます。それ以外の場合、そのトークンを使用したAPIコールはForbiddenレスポンスを返します。
   * 削除：トークンを削除することができます。この操作を行うと、トークンは復元できず、二度と使用することはできません。

編集と削除オプションのスクリーンショットは以下の通りです：

![](../integrations/assets/api-access-tokens/003.png)

### APIアクセストークンの作成と管理を制限する

デフォルトでは、**Owner**、**Administrator**、または**Developer**ポリシーを持つすべてのアカウントメンバーは、自分の既存の権限に限定されたアクセストークンを作成できます。アクセストークンリソースに関連する権限は3つあります：

* ListAccessTokens
* ManagePersonalAccessTokens
* ManageServiceAccessTokens

IAMポリシーを使用して、これらのアクションを追加または削除することで、アカウントメンバーがアクセストークンの作成や管理を行うことを制限できます。以下は、アクセストークンに関連するIAMポリシーステートメントのスクリーンショットです。

![](../integrations/assets/api-access-tokens/004.png)
